(window.webpackJsonp=window.webpackJsonp||[]).push([[84],{371:function(e,s,a){"use strict";a.r(s);var r=a(10),n=Object(r.a)({},(function(){var e=this,s=e._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"ms-sql-server-2017-for-linux"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ms-sql-server-2017-for-linux"}},[e._v("#")]),e._v(" MS SQL Server 2017 for Linux")]),e._v(" "),s("p",[e._v("文章參考處：")]),e._v(" "),s("ul",[s("li",[e._v("https://docs.microsoft.com/en-us/sql/linux/quickstart-install-connect-docker")]),e._v(" "),s("li",[e._v("https://docs.microsoft.com/zh-tw/sql/linux/quickstart-install-connect-docker")])]),e._v(" "),s("p",[e._v("Docker Hub:\nhttps://store.docker.com/images/mssql-server-linux")]),e._v(" "),s("hr"),e._v(" "),s("h1",{attrs:{id:"安裝"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安裝"}},[e._v("#")]),e._v(" 安裝")]),e._v(" "),s("h2",{attrs:{id:"下載-docker-image"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#下載-docker-image"}},[e._v("#")]),e._v(" 下載 Docker Image")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("docker pull microsoft/mssql-server-linux\n")])])]),s("h2",{attrs:{id:"啟動-docker-container"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#啟動-docker-container"}},[e._v("#")]),e._v(" 啟動 Docker Container")]),e._v(" "),s("p",[s("strong",[e._v("Start a mssql-server instance using the latest update for SQL Server 2017")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("$ docker run --name ms-sql -e 'ACCEPT_EULA=Y' -e 'SA_PASSWORD=Passw0rd' -p 1433:1433 -d microsoft/mssql-server-linux:2017-latest\n\n\n$ docker run -e 'ACCEPT_EULA=Y' -e 'SA_PASSWORD=Passw0rd' -p 1433:1433 -d microsoft/mssql-server-linux:latest\n")])])]),s("p",[s("strong",[e._v("Start a mssql-server instance running as the SQL Express edition")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("$ docker run -e 'ACCEPT_EULA=Y' -e 'SA_PASSWORD=Passw0rd' -e 'MSSQL_PID=Express' -p 1433:1433 -d microsoft/mssql-server-linux:latest\n")])])]),s("h2",{attrs:{id:"連上-sql-server"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#連上-sql-server"}},[e._v("#")]),e._v(" 連上 SQL Server")]),e._v(" "),s("p",[s("strong",[e._v("指令格式")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("docker exec -it <container_id|container_name> /opt/mssql-tools/bin/sqlcmd -S localhost -U sa -P <your_password>\n\n\ndocker exec -it ms-sql /opt/mssql-tools/bin/sqlcmd -S localhost -U sa -P Passw0rd\n")])])]),s("p",[s("strong",[e._v("實際演練：")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("$ docker exec -it ms-sql bash\n$ /opt/mssql-tools/bin/sqlcmd -S localhost -U SA -P 'Passw0rd'\n")])])]),s("p",[e._v("自 Host  連上 Docker Container 中執行的 SQL Server")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("sqlcmd -S 10.3.2.4,1401 -U SA -P 'Passw0rd'\n")])])]),s("h2",{attrs:{id:"驗證"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#驗證"}},[e._v("#")]),e._v(" 驗證")]),e._v(" "),s("p",[e._v("執行 Query 指令")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("CREATE DATABASE TestDB\nSELECT Name from sys.Databases\nGO\n")])])]),s("hr"),e._v(" "),s("h1",{attrs:{id:"令資料永續保存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#令資料永續保存"}},[e._v("#")]),e._v(" 令資料永續保存")]),e._v(" "),s("p",[e._v("Ref:")]),e._v(" "),s("ul",[s("li",[e._v("https://docs.microsoft.com/zh-tw/sql/linux/sql-server-linux-configure-docker#設定Docker容器")]),e._v(" "),s("li",[e._v("https://docs.docker.com/engine/admin/volumes/volumes/")])]),e._v(" "),s("p",[e._v("透過 Volume ，令 Docker Container 中執行的 SQL Server ，能將 Database 資料永續保存。")]),e._v(" "),s("p",[s("strong",[e._v("方法一：為資料磁碟區掛接主機目錄（Mount a host directory as data volume）")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("docker run -e 'ACCEPT_EULA=Y' -e 'MSSQL_SA_PASSWORD=<YourStrong!Passw0rd>' -p 1433:1433 -v <host directory>:/var/opt/mssql -d microsoft/mssql-server-linux:2017-latest\n\n\n\ndocker run --name ms-sql -e 'ACCEPT_EULA=Y' -e 'SA_PASSWORD=Passw0rd' -p 1433:1433 -v /Users/alanjui/ms-sql:/var/opt/mssql -d microsoft/mssql-server-linux:2017-latest \n\n\ndocker run --name ms-sql \\\n   -e 'ACCEPT_EULA=Y' -e 'SA_PASSWORD=Passw0rd' \\\n   -e 'MSSQL_PID=Developer' -p 1433:1433 \\\n   -v /d/data/ms-sql:/var/opt/mssql \\\n   -d microsoft/mssql-server-linux:latest\n")])])]),s("p",[s("strong",[e._v("方法二：使用資料磁碟區容器（Use data volume containers）")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("docker run -e 'ACCEPT_EULA=Y' -e 'MSSQL_SA_PASSWORD=<YourStrong!Passw0rd>' -p 1433:1433 -v sqlvolume:/var/opt/mssql -d microsoft/mssql-server-linux:2017-latest\n\n\n\ndocker volume create ms-sql-db-vol\n\ndocker volume ls\n\ndocker volume inspect ms-sql-db-vol\n\ndocker run --name ms-sql-server -e 'ACCEPT_EULA=Y' -e 'SA_PASSWORD=Passw0rd' -e 'MSSQL_PID=Developer' -p 1433:1433 -v ms-sql-db-vol:/var/opt/mssql -d microsoft/mssql-server-linux:latest\n\ndocker ps\n\ndocker exec -it ms-sql-server bash\n\n/opt/mssql-tools/bin/sqlcmd -S localhost -U SA -P 'Passw0rd'\n")])])]),s("h2",{attrs:{id:"建立資料庫"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#建立資料庫"}},[e._v("#")]),e._v(" 建立資料庫")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("CREATE DATABASE TestDB\nSELECT Name from sys.Databases\nGO\n")])])]),s("h2",{attrs:{id:"放入資料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#放入資料"}},[e._v("#")]),e._v(" 放入資料")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("USE TestDB\nCREATE TABLE Inventory (id INT, name NVARCHAR(50), quantity INT)\nINSERT INTO Inventory VALUES (1, 'banana', 150); \nINSERT INTO Inventory VALUES (2, 'orange', 154);\nGO\n")])])]),s("h2",{attrs:{id:"查詢資料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查詢資料"}},[e._v("#")]),e._v(" 查詢資料")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("SELECT * FROM Inventory WHERE quantity > 152;\nGO\n")])])]),s("h2",{attrs:{id:"退出-sql-server"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#退出-sql-server"}},[e._v("#")]),e._v(" 退出 SQL SERVER")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("QUIT\n\n\n\n$ docker stop ms-sql-server\n$ docker ps\n$ docker start ms-sql-server\n$ docker ps\n$ docker exec -it ms-sql-server bash\nroot@628c1e796fdc:/# /opt/mssql-tools/bin/sqlcmd -S localhost -U SA -P 'Passw0rd'\n1> USE TestDB\n2> SELECT * FROM Inventory WHERE quantity > 152;\n3> GO\nChanged database context to 'TestDB'.\nid          name                                               quantity\n----------- -------------------------------------------------- -----------\n          2 orange                                                     154\n\n(1 rows affected)\n1>\n")])])]),s("hr"),e._v(" "),s("h2",{attrs:{id:"vs-code-with-sql-server"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vs-code-with-sql-server"}},[e._v("#")]),e._v(" VS Code with SQL Server")]),e._v(" "),s("p",[e._v("Ref: https://docs.microsoft.com/zh-tw/sql/linux/sql-server-linux-develop-use-vscode")]),e._v(" "),s("p",[e._v("可使用 VS Code 執行以下 SQL Script。\n首次在 VS Code 啟用 SQL Script ， VS Code 會要求安裝「SQL Server (mssql)」Extension。\n執行 SQL Script ，使用 "),s("Cmd",[e._v(" + "),s("Shift",[e._v(" + E 按鍵。\n首次連上某 SQL Server 前， VS Code 會顯示要求建立 Server Connection Profile 的訊息。")])],1)],1),e._v(" "),s("p",[s("strong",[e._v("(1) Create DB")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("USE master\nGO\nIF NOT EXISTS (\n   SELECT name\n   FROM sys.databases\n   WHERE name = N'TutorialDB'\n)\nCREATE DATABASE [TutorialDB]\nGO\n")])])]),s("p",[s("strong",[e._v("(2) Create Table")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("-- Create a new table called 'Employees' in schema 'dbo'\n-- Drop the table if it already exists\nIF OBJECT_ID('dbo.Employees', 'U') IS NOT NULL\nDROP TABLE dbo.Employees\nGO\n-- Create the table in the specified schema\nCREATE TABLE dbo.Employees\n(\n   EmployeesId        INT    NOT NULL   PRIMARY KEY, -- primary key column\n   Name      \\[NVARCHAR\\](50)  NOT NULL,\n   Location   \\[NVARCHAR\\](50)  NOT NULL\n);\nGO\n")])])]),s("p",[s("strong",[e._v("(3) Insert Data and Query")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("-- Insert rows into table 'Employees'\nINSERT INTO Employees\n   ([EmployeesId],[Name],[Location])\nVALUES\n   ( 1, N'Jared', N'Australia'),\n   ( 2, N'Nikita', N'India'),\n   ( 3, N'Tom', N'Germany'),\n   ( 4, N'Jake', N'United States')   \nGO   \n-- Query the total count of employees\nSELECT COUNT(*) as EmployeeCount FROM dbo.Employees;\n-- Query all employee information\nSELECT e.EmployeesId, e.Name, e.Location \nFROM dbo.Employees as e\nGO\n")])])]),s("p",[e._v("在 Container  中，使用 sqlcmd shell command  查詢：")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("$ docker exec -it ms-sql-server bash\nroot@e3cd59d5fdb8:/# /opt/mssql-tools/bin/sqlcmd -S localhost -U SA -P Passw0rd\n1> select name from sys.databases\n2> go\nname\n--------------------------------------------------------------------------------------\nmaster\ntempdb\nmodel\nmsdb\nTutorialDB\n\n(5 rows affected)\n1> use TutorialDB\n2> select name from sys.tables\n3> go\nChanged database context to 'TutorialDB'.\nname\n--------------------------------------------------------------------------------------\nEmployees\n\n(1 rows affected)\n1>\n")])])]),s("hr"),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("CREATE DATABASE [Blogging];\nGO\nUSE [Blogging];\nGO\nCREATE TABLE [Blog] (\n    [BlogId] int NOT NULL IDENTITY,\n    [Url] nvarchar(max) NOT NULL,\n    CONSTRAINT [PK_Blog] PRIMARY KEY ([BlogId])\n);\nGO\nCREATE TABLE [Post] (\n    [PostId] int NOT NULL IDENTITY,\n    [BlogId] int NOT NULL,\n    [Content] nvarchar(max),\n    [Title] nvarchar(max),\n    CONSTRAINT [PK_Post] PRIMARY KEY ([PostId]),\n    CONSTRAINT [FK_Post_Blog_BlogId] FOREIGN KEY ([BlogId]) REFERENCES [Blog] ([BlogId]) ON DELETE CASCADE\n);\nGO\nINSERT INTO [Blog] (Url) VALUES\n('http://blogs.msdn.com/dotnet'),\n('http://blogs.msdn.com/webdev'),\n('http://blogs.msdn.com/visualstudio')\nGO\n")])])]),s("p",[e._v("查詢")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("USE [Blogging];\nSELECT * FROM Blog;\nGO\n")])])]),s("hr"),e._v(" "),s("h1",{attrs:{id:"狀況排除"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#狀況排除"}},[e._v("#")]),e._v(" 狀況排除")]),e._v(" "),s("h2",{attrs:{id:"_1-無法啟動-sql-server"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-無法啟動-sql-server"}},[e._v("#")]),e._v(" 1. 無法啟動 SQL Server")]),e._v(" "),s("p",[s("strong",[e._v("1.1 port is already allocated.")])]),e._v(" "),s("p",[e._v("導因：系統已安裝的 SQL Server 2014 Service 未關閉")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("(Wagtail)\nAlanJui@WIN-01 MINGW64 /d/Workspace/Docker\n$ docker run --name ms-sql-server -e 'ACCEPT_EULA=Y' -e 'SA_PASSWORD=Passw0rd' -p 1433:1433 -d microsoft/mssql-server-linux:latest\n3abc22f1d0de8916872a5e8718ae512e035d0194a3a83395d2143906effffcda\nC:\\Program Files\\Docker\\Docker\\Resources\\bin\\docker.exe: Error response from daemon: driver failed programming external connectivity on endpoint ms-sql-server (f6b2e675126634dfc3686a3c6b1df363094b69f8273ac2c768ffe56c1b7fe875): Error starting userland proxy: Bind for 0.0.0.0:1433 failed: port is already allocated.\n")])])]),s("p",[e._v("解法： 透過「服務」，將Service暫時停止。")]),e._v(" "),s("p",[s("strong",[e._v("1.2")]),e._v(' The container name "/ms-sql-server" is already in use by container "3abc22f1d0de8916872a5e8718ae512e035d0194a3a83395d2143906effffcda".')]),e._v(" "),s("p",[e._v("導因：先前啟動時，已建立的Continer已暫用相同的Port號")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("(Wagtail)\nAlanJui@WIN-01 MINGW64 /d/Workspace/Docker\n$ docker run --name ms-sql-server -e 'ACCEPT_EULA=Y' -e 'SA_PASSWORD=Passw0rd' -p 1433:1433 -d microsoft/mssql-server-linux:latest\nC:\\Program Files\\Docker\\Docker\\Resources\\bin\\docker.exe: Error response from daemon: Conflict. The container name \"/ms-sql-server\" is already in use by container \"3abc22f1d0de8916872a5e8718ae512e035d0194a3a83395d2143906effffcda\". You have to remove (or rename) that container to be able to reuse that name.\nSee 'C:\\Program Files\\Docker\\Docker\\Resources\\bin\\docker.exe run --help'.\n")])])]),s("p",[e._v("解法：")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("$ docker rmi 3abc\n$ docker run --name ms-sql-server -e 'ACCEPT_EULA=Y' -e 'SA_PASSWORD=Passw0rd' -p 1433:1433 -d microsoft/mssql-server-linux:latest\n910cdeae0fc0419ec5ae9bde7ca52a422944c2a8692c07f3aff9327822764b07\n")])])]),s("h2",{attrs:{id:"終止佔用-port-1433-之-process"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#終止佔用-port-1433-之-process"}},[e._v("#")]),e._v(" 終止佔用 Port 1433 之 Process")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("$ docker run -e 'ACCEPT_EULA=Y' -e 'MSSQL_SA_PASSWORD=Passw0rd' --cap-add SYS_PTRACE -p 1433:1433 -v ~/data/ms-sql:/var/opt/mssql -d microsoft/mssql-server-linux  --name ms-sql-server --rm\n6c0d85e32cfc402071e68da4a75fc250e62eafb14b9576033f747cbfcbca647d\ndocker: Error response from daemon: driver failed programming external connectivity on endpoint objective_torvalds (6d0bb21569324d91538ebd0b76a75096c6df31c797c7bc483ccd0122025e33c3): Error starting userland proxy: listen tcp 0.0.0.0:1433: bind: address already in use.\n\n\n$ sudo kill `sudo lsof -t -i:1433`\n")])])]),s("hr"),e._v(" "),s("h2",{attrs:{id:"變更-sa-密碼"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#變更-sa-密碼"}},[e._v("#")]),e._v(" 變更 sa 密碼")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("docker exec -it <Container ID> /opt/mssql-tools/bin/sqlcmd -S localhost -U SA -P '<Old Password>' -Q 'ALTER LOGIN SA WITH PASSWORD=\"<New Password>\";'\n")])])]),s("hr"),e._v(" "),s("h2",{attrs:{id:"使用data-volume-containers"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用data-volume-containers"}},[e._v("#")]),e._v(" 使用data volume containers")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("docker run  --name ms-sql-server -e 'ACCEPT_EULA=Y' -e 'MSSQL_SA_PASSWORD=Passw0rd' -p 1433:1433 -v /d/data/ms-sql:/var/opt/mssql -d microsoft/mssql-server-linux\n\n\ndocker run  --name mssql-linux --rm -e 'ACCEPT_EULA=Y' -e 'MSSQL_SA_PASSWORD=Passw0rd' --cap-add SYS_PTRACE -p 1433:1433 -v ~/data/ms-sql:/var/opt/mssql -d microsoft/mssql-server-linux\n\n\n\n\n$ docker volume create --help\n\nUsage:  docker volume create \\[OPTIONS\\] [VOLUME]\n\nCreate a volume\n\nOptions:\n  -d, --driver string   Specify volume driver name (default \"local\")\n      --label list      Set metadata for a volume\n  -o, --opt map         Set driver specific options (default map[])\n\nAlanJui@WIN-01 MINGW64 /d/Workspace\n$ docker volume create --label ms-sql-db\n28edf7296921a219f6d00cbb95f540483d38b88af19f76587d387c46406095e7\n")])])]),s("hr"),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("docker login\ndocker pull microsoft/mssql-server-linux:latest\n\n\n\ndocker run --name ms-sql-server \\\n   -e 'ACCEPT_EULA=Y' -e 'SA_PASSWORD=Passw0rd' \\\n   -e 'MSSQL_PID=Developer ' -p 1433:1433 \\\n   -d microsoft/mssql-server-linux:latest\n\n\n\ndocker exec -it ms-sql-server bash\n")])])]),s("p",[e._v("Change Password:")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("docker exec -it sql1 /opt/mssql-tools/bin/sqlcmd \\\n   -S localhost -U SA -P '<YourStrong!Passw0rd>' \\\n   -Q 'ALTER LOGIN SA WITH PASSWORD=\"<YourNewStrong!Passw0rd>\"'\n\n\n\ndocker exec -it ms-sql-server /opt/mssql-tools/bin/sqlcmd \\\n   -S localhost -U SA -P 'Passw0rd' \\\n   -Q 'ALTER LOGIN SA WITH PASSWORD=\"ChingHai99@\"'\n")])])]),s("hr"),e._v(" "),s("h2",{attrs:{id:"linux-macos"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#linux-macos"}},[e._v("#")]),e._v(" Linux / MacOS")]),e._v(" "),s("p",[s("strong",[e._v("啟動 SQL Server 的 Docker Image")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("docker run --name mssql-linux --rm -e 'ACCEPT_EULA=Y' -e 'MSSQL_SA_PASSWORD=Passw0rd' -e 'MSSQL_PID=Developer' --cap-add SYS_PTRACE -p 1433:1433 -d microsoft/mssql-server-linux\n")])])]),s("p",[e._v("連上 SQL Server")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v('docker exec -it mssql-linux "bash"\n')])])]),s("p",[e._v("登入SQL Server")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v("/opt/mssql-tools/bin/sqlcmd -S localhost -U SA -P 'Passw0rd'\n")])])]),s("hr"),e._v(" "),s("h2",{attrs:{id:"windows-10"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#windows-10"}},[e._v("#")]),e._v(" Windows 10")]),e._v(" "),s("p",[e._v("啟動 Docker Container")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v('docker run --name mssql-linux --rm -e "ACCEPT_EULA=Y" -e "MSSQL_SA_PASSWORD=Passw0rd" -e "MSSQL_PID=Developer" --cap-add SYS_PTRACE -p 1401:1433 -d microsoft/mssql-server-linux\n')])])]),s("p",[e._v("連上SQL Server")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[e._v('docker exec -it mssql-linux "bash"\n')])])])])}),[],!1,null,null,null);s.default=n.exports}}]);