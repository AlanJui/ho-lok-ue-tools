(window.webpackJsonp=window.webpackJsonp||[]).push([[115],{402:function(e,n,t){"use strict";t.r(n);var r=t(10),o=Object(r.a)({},(function(){var e=this,n=e._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"ubuntu-qemu-kvm-libvirt"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu-qemu-kvm-libvirt"}},[e._v("#")]),e._v(" Ubuntu QEMU/KVM/Libvirt")]),e._v(" "),n("p",[e._v("https://www.youtube.com/watch?v=2SdSiJTGKLM&")]),e._v(" "),n("p",[n("a",{attrs:{href:"https://youtu.be/2SdSiJTGKLM",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://youtu.be/2SdSiJTGKLM"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("img",{attrs:{src:"https://paper-attachments.dropbox.com/s_A95431A2A3965C3081D7C5E4A15B0A1AD7277E450233574D54E3FFB13242D8F0_1607783224168_image.png",alt:""}})]),e._v(" "),n("h2",{attrs:{id:"安裝-kvm"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安裝-kvm"}},[e._v("#")]),e._v(" 安裝 KVM")]),e._v(" "),n("p",[e._v("https://linuxhint.com/install_kvm_ubuntu-2/")]),e._v(" "),n("p",[e._v("https://linuxize.com/post/how-to-install-kvm-on-ubuntu-20-04/")]),e._v(" "),n("hr"),e._v(" "),n("p",[e._v("完成 KVM 安裝作業後，須登出／重開機，使用以下指令確認，與 QEMU 相關的 Bridge, NIC 的網路設備是否都已存在於作業系統中。")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ ip link show master virbr0\n5: virbr0-nic: <BROADCAST,MULTICAST> mtu 1500 qdisc fq_codel master virbr0 state DOWN mode DEFAULT group default qlen 1000\n    link/ether 52:54:00:1c:ea:b4 brd ff:ff:ff:ff:ff:ff\n\n\n\n$ bridge link show dev virbr0-nic\n5: virbr0-nic: <BROADCAST,MULTICAST> mtu 1500 master virbr0 state disabled priority 32 cost 100 \n\n\n\n$ ip a s virbr0\n4: virbr0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN group default qlen 1000\n    link/ether 52:54:00:1c:ea:b4 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0\n       valid_lft forever preferred_lft forever\n")])])]),n("hr"),e._v(" "),n("h2",{attrs:{id:"【案例一】"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#【案例一】"}},[e._v("#")]),e._v(" 【案例一】")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("cd /kvm/iso\nsudo wget https://releases.ubuntu.com/20.04/ubuntu-20.04.1-live-server-amd64.iso\n\n\n\nvirt-install --name server-01 \\\n--os-type linux \\\n--os-variant ubuntu20.04 \\\n--ram 1024 \\\n--disk /kvm/disk/server-01.img,device=disk,bus=virtio,size=10,format=qcow2 \\\n--graphics vnc,listen=0.0.0.0 \\\n--noautoconsole \\\n--hvm \\\n--cdrom /kvm/iso/ubuntu-20.04.1-live-server-amd64.iso \\\n--boot cdrom,hd\n")])])]),n("h2",{attrs:{id:"【案例二】configuring-guest-networking"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#【案例二】configuring-guest-networking"}},[e._v("#")]),e._v(" 【案例二】Configuring Guest Networking")]),e._v(" "),n("p",[e._v("http://www.linux-kvm.org/page/Networking")]),e._v(" "),n("hr"),e._v(" "),n("h2",{attrs:{id:"使用指令建置-vm"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用指令建置-vm"}},[e._v("#")]),e._v(" 使用指令建置 VM")]),e._v(" "),n("p",[n("strong",[e._v("使用 qemu-img 建置虛擬硬碟")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("qemu-img create -f qcow2 vm12-debian-10.qcow2 40G\n")])])]),n("p",[n("strong",[e._v("使用 virt-install 建置 VM")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v('#!/bin/sh\nVM_NAME="ARCH-02"\necho "VM_NAME=$VM_NAME"\nvirt-install \\\n    --name "$VM_NAME" \\\n    --os-variant=generic \\\n    --hvm \\\n    --cpu host \\\n    --vcpus=6 \\\n    --ram 2048 \\\n    --graphics spice \\\n    --network bridge=br0 \\\n    --disk path=/var/lib/libvirt/images/$VM_NAME,size=60 \\\n    --cdrom /kvm/iso/archlinux-2020.12.01-x86_64.iso \\\n    --boot uefi\n\n\n$ ./s02-install-vm\n\n\nvirt-install \\\n  --name VM12-Debian-10 \\\n  --os-type linux \\\n  --os-variant generic \\\n  --vcpus 6 \\\n  --ram 2048 \\\n  --birdge=br0 \\\n  --cdrom ./debian-mac-10.6.0-i386-netinst.iso \\\n  --disk ./vm12-debian-10.qcow2\n')])])]),n("p",[n("strong",[e._v("使用 qemu-system-x86_64 建置 VM")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("qemu-system-x86_64 \\\n  -machine q35,accel=hvf \\\n  -cpu host \\\n  -m 2048 \\\n  -display default,show-cursor=on \\\n  -vga virtio \\\n  -usb \\\n  -device usb-tablet \\\n  -netdev bridge,br=br0,id=n1 \\\n  -device virtio-net,netdev=n1 \\\n  -vnc :5 \\\n  -hda ./vdisk1.qcow2,if=virtio \\\n  -cdrom $HOME/worksapce/qemu/ISO/debian-10.6.0-amd64-netinst.iso \\\n  -boot d \n\n\n\nqemu-system-x86_64 \\\n-machine q35,accel=hvf \\\n-cpu host \\\n-m 2048 \\\n-display default,show-cursor=on \\\n-vga virtio \\\n-usb \\\n-device usb-tablet \\\n-nic user,model=virtio,ipv6=off \\\n-net bridge,name=bridge1 \\\n-drive media=disk,format=qcow2,file=./vdisk1.qcow2 \\\n-cdrom $HOME/workspace/qemu/ISO/ubunttu-20.10-desktop-amd64.iso \\\n-boot d\n\n\n\n\n\n\nqemu-system-x86_64 \\\n-machine q35,accel=hvf \\\n-cpu host \\\n-m 2048 \\\n-display default,show-cursor=on \\\n-vga virtio \\\n-usb \\\n-device usb-tablet \\\n-nic tap,model=virtio,ipv6=off \\\n-netdev tap,script=./qemu-ifup.sh,downscript=./qemu-ifdown.sh \\\n-vnc :5 \\\n-hda ./vdisk1.qcow2 \\\n-cdrom $HOME/workspace/qemu/ISO/debian-10.6.0-amd64-netinst.iso \\\n-boot d\n\n\n\n  -nic tap,model=virtio,ipv6=off \\\n  -netdev tap,script=./qemu-ifup.sh,downscript=./qemu-ifdown.sh \\ \n\n\n\n  -nic tap,model=virtio,ipv6=off \\\n  -netdev tap,id=nd0,ifname=tap0,br=br0 \\\n\n\n\n\nqemu-system-x86_64 \\\n  -hda vdisk1.qcow2\n  -cdrom $HOME/worksapce/qemu/ISO/debian-10.6.0-amd64-netinst.iso \\\n  -m 2048 \\\n  -accel hvf \\\n  -vga virtio \\\n  -usb \\\n  -device usb-tablet \\\n  -display default,show-ciursor=on \\\n  -boot d\n")])])]),n("hr"),e._v(" "),n("h2",{attrs:{id:"使用圖形介面工具建置虛擬橋接器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用圖形介面工具建置虛擬橋接器"}},[e._v("#")]),e._v(" 使用圖形介面工具建置虛擬橋接器")]),e._v(" "),n("p",[e._v("使用「"),n("strong",[e._v("圖形介面工具")]),e._v("」： nm-connection-editor ，在「虛擬網路」建置「虛擬橋接器」。")]),e._v(" "),n("p",[n("strong",[e._v("（1）暫停 Network Manager 網路服務。")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("sudo systemctl stop NetworkManager\n")])])]),n("p",[n("strong",[e._v("（2）Remove connection profile：刪除「有線網路設定檔」，以便原「有線網路卡」釋放出 IP 。")])]),e._v(" "),n("p",[n("img",{attrs:{src:"https://paper-attachments.dropbox.com/s_A95431A2A3965C3081D7C5E4A15B0A1AD7277E450233574D54E3FFB13242D8F0_1607307972771_image.png",alt:""}})]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ ip a\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: eno1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000\n    link/ether 90:2b:34:d1:a6:1b brd ff:ff:ff:ff:ff:ff\n3: wlxd0c0bf50e619: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000\n    link/ether d0:c0:bf:50:e6:19 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.66.215/24 brd 192.168.66.255 scope global dynamic noprefixroute wlxd0c0bf50e619\n       valid_lft 603037sec preferred_lft 603037sec\n    inet6 fd00:30b7:d45e:4bf2:24c1:2b9a:4515:5ccc/64 scope global temporary dynamic \n       valid_lft 535423sec preferred_lft 84529sec\n    inet6 fd00:30b7:d45e:4bf2:23d3:ea79:b82d:3ee9/64 scope global dynamic mngtmpaddr noprefixroute \n       valid_lft 535423sec preferred_lft 401566sec\n    inet6 fe80::a062:787:9737:838/64 scope link noprefixroute \n       valid_lft forever preferred_lft forever\n")])])]),n("p",[n("strong",[e._v("（3）使用 nm-connectiion-editor 指令，建置虛擬網路所需使用的虛擬橋接器（bridge0）")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ sudo nm-connection-editor\n")])])]),n("p",[n("img",{attrs:{src:"https://paper-attachments.dropbox.com/s_A95431A2A3965C3081D7C5E4A15B0A1AD7277E450233574D54E3FFB13242D8F0_1607308205175_image.png",alt:""}})]),e._v(" "),n("p",[n("img",{attrs:{src:"https://paper-attachments.dropbox.com/s_A95431A2A3965C3081D7C5E4A15B0A1AD7277E450233574D54E3FFB13242D8F0_1607308313753_image.png",alt:""}})]),e._v(" "),n("p",[n("img",{attrs:{src:"https://paper-attachments.dropbox.com/s_A95431A2A3965C3081D7C5E4A15B0A1AD7277E450233574D54E3FFB13242D8F0_1607308358839_image.png",alt:""}})]),e._v(" "),n("p",[n("img",{attrs:{src:"https://paper-attachments.dropbox.com/s_A95431A2A3965C3081D7C5E4A15B0A1AD7277E450233574D54E3FFB13242D8F0_1607308407161_image.png",alt:""}})]),e._v(" "),n("p",[n("img",{attrs:{src:"https://paper-attachments.dropbox.com/s_A95431A2A3965C3081D7C5E4A15B0A1AD7277E450233574D54E3FFB13242D8F0_1607308448623_image.png",alt:""}})]),e._v(" "),n("p",[n("img",{attrs:{src:"https://paper-attachments.dropbox.com/s_A95431A2A3965C3081D7C5E4A15B0A1AD7277E450233574D54E3FFB13242D8F0_1607308495922_image.png",alt:""}})]),e._v(" "),n("p",[n("img",{attrs:{src:"https://paper-attachments.dropbox.com/s_A95431A2A3965C3081D7C5E4A15B0A1AD7277E450233574D54E3FFB13242D8F0_1607308521825_image.png",alt:"將 Connection name 改成：bridge0"}})]),e._v(" "),n("p",[n("img",{attrs:{src:"https://paper-attachments.dropbox.com/s_A95431A2A3965C3081D7C5E4A15B0A1AD7277E450233574D54E3FFB13242D8F0_1607308573498_image.png",alt:""}})]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ ip a\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: eno1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel master bridge0 state UP group default qlen 1000\n    link/ether 90:2b:34:d1:a6:1b brd ff:ff:ff:ff:ff:ff\n3: wlxd0c0bf50e619: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000\n    link/ether d0:c0:bf:50:e6:19 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.66.215/24 brd 192.168.66.255 scope global dynamic noprefixroute wlxd0c0bf50e619\n       valid_lft 603292sec preferred_lft 603292sec\n    inet6 fd00:30b7:d45e:4bf2:24c1:2b9a:4515:5ccc/64 scope global temporary dynamic \n       valid_lft 535421sec preferred_lft 84783sec\n    inet6 fd00:30b7:d45e:4bf2:23d3:ea79:b82d:3ee9/64 scope global dynamic mngtmpaddr noprefixroute \n       valid_lft 535421sec preferred_lft 401564sec\n    inet6 fe80::a062:787:9737:838/64 scope link noprefixroute \n       valid_lft forever preferred_lft forever\n5: bridge0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN group default qlen 1000\n    link/ether 90:2b:34:d1:a6:1b brd ff:ff:ff:ff:ff:ff\n")])])]),n("p",[n("strong",[e._v("（4）重新啟動作業系統的網路功能")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("sudo systemctl restart NetworkManager\n\n\nsudo systemctl restart networking\n")])])]),n("p",[e._v("習慣用 service 指令者，亦能以下列方式，重新啟動作業系統的網路：")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("sudo service network-manager restart\n\n\n\n$ ip a                                \n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: eno1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel master bridge0 state UP group default qlen 1000\n    link/ether 90:2b:34:d1:a6:1b brd ff:ff:ff:ff:ff:ff\n3: wlxd0c0bf50e619: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000\n    link/ether d0:c0:bf:50:e6:19 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.66.215/24 brd 192.168.66.255 scope global dynamic noprefixroute wlxd0c0bf50e619\n       valid_lft 604793sec preferred_lft 604793sec\n    inet6 fd00:30b7:d45e:4bf2:24c1:2b9a:4515:5ccc/64 scope global temporary dynamic \n       valid_lft 535425sec preferred_lft 86285sec\n    inet6 fd00:30b7:d45e:4bf2:23d3:ea79:b82d:3ee9/64 scope global dynamic mngtmpaddr noprefixroute \n       valid_lft 535425sec preferred_lft 401568sec\n    inet6 fe80::a062:787:9737:838/64 scope link noprefixroute \n       valid_lft forever preferred_lft forever\n6: bridge0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether 90:2b:34:d1:a6:1b brd ff:ff:ff:ff:ff:ff\n    inet 192.168.66.217/24 brd 192.168.66.255 scope global dynamic noprefixroute bridge0\n       valid_lft 604789sec preferred_lft 604789sec\n    inet6 fd00:30b7:d45e:4bf2:d3e5:e9f6:99d:79c/64 scope global dynamic noprefixroute \n       valid_lft 535425sec preferred_lft 401568sec\n    inet6 fe80::ea43:3bee:13c4:8e43/64 scope link noprefixroute \n       valid_lft forever preferred_lft forever\n")])])]),n("p",[n("strong",[e._v("（4）驗證 bridge 0 已能正常運作")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ ping google.com\nPING google.com (216.58.200.238) 56(84) bytes of data.\n64 bytes from tsa03s01-in-f238.1e100.net (216.58.200.238): icmp_seq=1 ttl=118 time=14.7 ms\n64 bytes from tsa03s01-in-f238.1e100.net (216.58.200.238): icmp_seq=2 ttl=118 time=8.85 ms\n64 bytes from tsa03s01-in-f238.1e100.net (216.58.200.238): icmp_seq=3 ttl=118 time=11.2 ms\n^C\n--- google.com ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2003ms\nrtt min/avg/max/mdev = 8.854/11.588/14.738/2.420 ms\n")])])]),n("hr"),e._v(" "),n("h2",{attrs:{id:"手動建置虛擬橋接器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#手動建置虛擬橋接器"}},[e._v("#")]),e._v(" 手動建置虛擬橋接器")]),e._v(" "),n("p",[e._v("使用實體的「有線網路卡」，建置可連接 VM 的「虛擬橋接器」。")]),e._v(" "),n("p",[n("strong",[e._v("（1）停用實體的有線網路卡（NIC）")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ ip a\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n2: eno1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000\n    link/ether 90:2b:34:d1:a6:1b brd ff:ff:ff:ff:ff:ff\n    inet 192.168.66.10/24 brd 192.168.66.255 scope global dynamic noprefixroute eno1\n       valid_lft 574391sec preferred_lft 574391sec\n3: wlxd0c0bf50e619: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether d0:c0:bf:50:e6:19 brd ff:ff:ff:ff:ff:ff\n\n$ sudo ip link set eno1 down\n\n$ ip a\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n2: eno1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state DOWN group default qlen 1000\n    link/ether 90:2b:34:d1:a6:1b brd ff:ff:ff:ff:ff:ff\n    inet 192.168.66.10/24 brd 192.168.66.255 scope global dynamic noprefixroute eno1\n       valid_lft 574391sec preferred_lft 574391sec\n3: wlxd0c0bf50e619: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether d0:c0:bf:50:e6:19 brd ff:ff:ff:ff:ff:ff\n")])])]),n("p",[n("strong",[e._v("（2）去除「有線網路卡」原先已繫結的 IP 網址")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ sudo ip addr del 192.168.66.10/24 dev eno1\n\n$ ip a\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen s1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n2: eno1: <BROADCAST,MULTICAST> mtu 1500 qdisc fq_codel state DOWN group default qlen 1000\n    link/ether 90:2b:34:d1:a6:1b brd ff:ff:ff:ff:ff:ff\n3: wlxd0c0bf50e619: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000\n    link/ether d0:c0:bf:50:e6:19 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.0.103/24 brd 192.168.0.255 scope global dynamic noprefixroute wlxd0c0bf50e619\n       valid_lft 86371sec preferred_lft 86371sec\n")])])]),n("p",[n("strong",[e._v("（3）停用 NetworkManager (network-manager) 服務")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ sudo systemctl status NetworkManager\n$ sudo systemctl stop NetworkManager\n$ sudo systemctl status NetworkManager\n")])])]),n("p",[e._v("註： NetworkManager 可用 network-manager 代。")]),e._v(" "),n("p",[n("strong",[e._v("（4）停用 systemd-networkd 服務")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ sudo systemctl status systemd-networkd\n● systemd-networkd.service - Network Service\n     Loaded: loaded (/lib/systemd/system/systemd-networkd.service; disabled; vendor preset: enabled)\n     Active: inactive (dead)\n       Docs: man:systemd-networkd.service(8)\n")])])]),n("p",[n("strong",[e._v("（5）建立「虛擬橋接器」，並將之命名為： br0")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ sudo ip link add name br0 type bridge\n\n$ ip a\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n2: eno1: <BROADCAST,MULTICAST> mtu 1500 qdisc fq_codel state DOWN group default qlen 1000\n    link/ether 90:2b:34:d1:a6:1b brd ff:ff:ff:ff:ff:ff\n3: wlxd0c0bf50e619: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000\n    link/ether d0:c0:bf:50:e6:19 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.0.103/24 brd 192.168.0.255 scope global dynamic noprefixroute wlxd0c0bf50e619\n       valid_lft 85944sec preferred_lft 85944sec\n9: br0: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether be:bd:64:83:d8:23 brd ff:ff:ff:ff:ff:ff\n")])])]),n("p",[n("strong",[e._v("（6）將「虛擬橋接器（br0）」的網路連接介面，設定成：「有線網路卡（eno1）」")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ sudo ip link set eno1 master br0\n\n$ ip a\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n2: eno1: <BROADCAST,MULTICAST> mtu 1500 qdisc fq_codel master br0 state DOWN group default qlen 1000\n    link/ether 90:2b:34:d1:a6:1b brd ff:ff:ff:ff:ff:ff\n3: wlxd0c0bf50e619: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000\n    link/ether d0:c0:bf:50:e6:19 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.0.103/24 brd 192.168.0.255 scope global dynamic noprefixroute wlxd0c0bf50e619\n       valid_lft 85805sec preferred_lft 85805sec\n9: br0: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether 90:2b:34:d1:a6:1b brd ff:ff:ff:ff:ff:ff\n")])])]),n("p",[n("strong",[e._v("（7）設定「虛擬橋接器（br0）」 的 IP 網址")])]),e._v(" "),n("ul",[n("li",[n("strong",[e._v("IP 網址： 192.168.4.7 ；")])]),e._v(" "),n("li",[n("strong",[e._v("廣播網址：192.168.255.255")]),e._v("\n$ sudo ip addr add 192.168.4.7/16 dev br0 brd 192.168.255.255")])]),e._v(" "),n("p",[n("strong",[e._v("（8）啟動「虛擬橋接器（br0）」")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ sudo ip link set up eno1 &&\\\nsudo ip link set up br0\n")])])]),n("hr"),e._v(" "),n("h2",{attrs:{id:"管理-kvm-libvirtd-網路"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#管理-kvm-libvirtd-網路"}},[e._v("#")]),e._v(" 管理 KVM/libvirtd 網路")]),e._v(" "),n("p",[e._v("使用 virsh 指令管理 KVM/libvirtd 網路。")]),e._v(" "),n("p",[e._v("KVM/libvirtd 網路使用的「網路介面」：")]),e._v(" "),n("ul",[n("li",[e._v("虚擬橋接器：vibr0")]),e._v(" "),n("li",[e._v("虚擬網路卡：vibr0-nic")])]),e._v(" "),n("p",[n("strong",[e._v("修復已毀損的 default 網路")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ sudo virsh net-start default\nERROR    Requested operation is not valid: network 'default' is not active\n")])])]),n("p",[e._v("https://blog.programster.org/kvm-missing-default-network")]),e._v(" "),n("p",[n("strong",[e._v("啟動 default 網路")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ virsh net-start default\nNetwork default started\n\n$ virsh net-list\n Name      State    Autostart   Persistent\n--------------------------------------------\n default   active   yes         yes\n\n$ ip a                   \n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n2: eno1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000\n    link/ether 90:2b:34:d1:a6:1b brd ff:ff:ff:ff:ff:ff\n    inet 192.168.66.10/24 brd 192.168.66.255 scope global dynamic noprefixroute eno1\n       valid_lft 604370sec preferred_lft 604370sec\n3: enx00e04c361a3c: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000\n    link/ether 00:e0:4c:36:1a:3c brd ff:ff:ff:ff:ff:ff\n6: wlxd0c0bf50e619: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether d0:c0:bf:50:e6:19 brd ff:ff:ff:ff:ff:ff\n9: vibr0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN group default qlen 1000\n    link/ether 52:54:00:01:cd:21 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.122.1/24 brd 192.168.122.255 scope global vibr0\n       valid_lft forever preferred_lft forever\n10: vibr0-nic: <BROADCAST,MULTICAST> mtu 1500 qdisc fq_codel master vibr0 state DOWN group default qlen 1000\n    link/ether 52:54:00:01:cd:21 brd ff:ff:ff:ff:ff:ff\n")])])]),n("p",[n("strong",[e._v("關閉 default 網路")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ virsh net-destroy default\nNetwork default destroyed\n\n$ virsh net-list           \n Name   State   Autostart   Persistent\n----------------------------------------\n\n$ ip a\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n2: eno1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000\n    link/ether 90:2b:34:d1:a6:1b brd ff:ff:ff:ff:ff:ff\n    inet 192.168.66.10/24 brd 192.168.66.255 scope global dynamic noprefixroute eno1\n       valid_lft 604425sec preferred_lft 604425sec\n3: enx00e04c361a3c: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000\n    link/ether 00:e0:4c:36:1a:3c brd ff:ff:ff:ff:ff:ff\n6: wlxd0c0bf50e619: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether d0:c0:bf:50:e6:19 brd ff:ff:ff:ff:ff:ff\n")])])]),n("hr"),e._v(" "),n("h2",{attrs:{id:"透過虚擬橋接器建置虛擬機-vm"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#透過虚擬橋接器建置虛擬機-vm"}},[e._v("#")]),e._v(" 透過虚擬橋接器建置虛擬機（VM）")]),e._v(" "),n("p",[e._v("使用 virt-install 指令，搭配「bridge」option，建置「虛擬機」。")]),e._v(" "),n("p",[n("strong",[e._v("（1）確認作業系統中有可用的「有線網路卡」")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ nmcli connection show --active\nNAME                 UUID                                  TYPE      DEVICE          \n有線連線 1            145fcaf0-9e92-3c5d-976a-763ff771a8b1  ethernet  eno1            \nCCC Dlink-6AD2-5GHz  2219a958-d49c-4b27-a936-77208aba2139  wifi      wlxd0c0bf50e619 \nvirbr0               7d1cbd53-1411-44ee-bce6-c2c5d69bd36e  bridge    virbr0      \n")])])]),n("p",[n("strong",[e._v("（2）建立虛擬橋接器（br0）")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ sudo nmcli con add ifname br0 type bridge con-name br0\n連線「br0」 (0cf1c559-1ddf-4ce6-be7c-92c74d458695) 已成功新增。\n\n$ sudo nmcli con add type bridge-slave ifname enp0s31f6 master br0\n連線「bridge-slave-enp0s31f6」 (faf70f17-371c-49bf-b68f-87b0b3d98571) 已成功新增。\n\n$ nmcli connection show\nNAME                    UUID                                  TYPE       DEVICE          \nbr0                     0cf1c559-1ddf-4ce6-be7c-92c74d458695  bridge     br0             \n有線連線 1               145fcaf0-9e92-3c5d-976a-763ff771a8b1  ethernet   eno1            \nCCC Dlink-6AD2-5GHz     2219a958-d49c-4b27-a936-77208aba2139  wifi       wlxd0c0bf50e619 \nvirbr0                  7d1cbd53-1411-44ee-bce6-c2c5d69bd36e  bridge     virbr0          \nbridge-slave-enp0s31f6  faf70f17-371c-49bf-b68f-87b0b3d98571  ethernet   --              \nCCC99-5G                fddcb72d-251a-42be-bd72-6f3e16ccdbdd  wifi       --              \nHotspot                 65a39bb3-f67c-4a7b-bd95-62493218aa99  wifi       --              \niPhone-CCC 網路         525bb90a-f228-4a36-a3e1-661db85890be  bluetooth  --   \n")])])]),n("p",[n("strong",[e._v("（3）設定 IP V4 網路")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ sudo nmcli connection modify br0 ipv4.addresses '192.168.66.90/24'\n$ sudo nmcli connection modify br0 ipv4.gateway '192.168.66.1'\n$ sudo nmcli connection modify br0 ipv4.dns '192.168.66.1'\n$ sudo nmcli connection modify br0 ipv4.dns-search 'ccc99.tw'\n$ sudo nmcli connection modify br0 ipv4.method manual\n")])])]),n("p",[n("strong",[e._v("（4）設定執行 virt-install 指令時，所需的「環境變數」")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v('export ISO="/var/lib/libvirt/boot/CentOS-8.2.2004-x86_64-dvd1.iso"\nexport NET="br0"\nexport OS="centos8"\nexport VM_IMG="/var/lib/libvirt/images/centos8.qcow2"\n')])])]),n("p",[n("strong",[e._v("（5）使用 virt-install 指令，建置 VM")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v('sudo virt-install \\\n--virt-type=kvm \\\n--name centos8 \\\n--ram 2048 \\\n--vcpus=2 \\\n--os-variant=${OS} \\\n--virt-type=kvm \\\n--hvm \\\n--cdrom=${ISO} \\\n--network=bridge=${NET},model=virtio \\\n--graphics vnc \\\n--disk path=${VM_IMG},size=40,bus=virtio,format=qcow2\n\n\n\nsudo virt-install \\\n--virt-type=kvm \\\n--name centos8-3 \\\n--ram 2048 \\\n--vcpus=2 \\\n--os-variant="centos8" \\\n--virt-type=kvm \\\n--hvm \\\n--cdrom="/var/lib/libvirt/boot/CentOS-8.2.2004-x86_64-dvd1.iso" \\\n--network=bridge="br0",model=virtio \\\n--graphics vnc \\\n--disk path="/var/lib/libvirt/images/centos8-3.qcow2",size=40,bus=virtio,format=qcow2\n')])])]),n("p",[n("strong",[e._v("【參考資料】： LibVirt 目錄結構")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ ll /etc/libvirt \n總計 132\ndrwxr-xr-x   7 root root  4096 12月  4 11:04 ./\ndrwxr-xr-x 152 root root 12288 12月  4 11:35 ../\ndrwxr-xr-x   2 root root  4096 10月  8 13:36 hooks/\n-rw-r--r--   1 root root   450 10月  8 13:36 libvirt-admin.conf\n-rw-r--r--   1 root root   547 10月  8 13:36 libvirt.conf\n-rw-r--r--   1 root root 16715 10月  8 13:36 libvirtd.conf\n-rw-r--r--   1 root root  2268 10月  8 13:36 libxl.conf\n-rw-r--r--   1 root root  2169 10月  8 13:36 libxl-lockd.conf\n-rw-r--r--   1 root root  2465 10月  8 13:36 libxl-sanlock.conf\n-rw-r--r--   1 root root  1175 10月  8 13:36 lxc.conf\ndrwxr-xr-x   2 root root  4096 12月  4 11:04 nwfilter/\ndrwxr-xr-x   3 root root  4096 12月  4 18:44 qemu/\n-rw-------   1 root root 32342 10月  8 13:36 qemu.conf\n-rw-r--r--   1 root root  2169 10月  8 13:36 qemu-lockd.conf\n-rw-r--r--   1 root root  2465 10月  8 13:36 qemu-sanlock.conf\ndrwx------   2 root root  4096 12月  1 10:49 secrets/\ndrwxr-xr-x   3 root root  4096 12月  4 12:51 storage/\n-rw-r--r--   1 root root  3058 10月  8 13:36 virtlockd.conf\n-rw-r--r--   1 root root  3374 10月  8 13:36 virtlogd.conf\n-rw-r--r--   1 root root  1883 10月  8 13:36 virt-login-shell.conf\n\n\n\n$ll /etc/libvirt/qemu\n總計 44\ndrwxr-xr-x 3 root root 4096 12月  4 18:44 ./\ndrwxr-xr-x 7 root root 4096 12月  4 11:04 ../\n-rw------- 1 root root 5878 12月  4 18:44 centos8-2.xml\n-rw------- 1 root root 5326 12月  4 13:52 centos8.xml\n-rw------- 1 root root 5888 12月  1 21:57 debian10.xml\ndrwxr-xr-x 3 root root 4096 12月  4 11:04 networks/\n-rw------- 1 root root 4385 12月  1 12:00 VM01-Ubuntu-2010.xml\n\n\n\n$ ll /etc/libvirt/qemu/networks \n總計 16\ndrwxr-xr-x 3 root root 4096 12月  4 11:04 ./\ndrwxr-xr-x 3 root root 4096 12月  4 18:44 ../\ndrwxr-xr-x 2 root root 4096 12月  4 11:04 autostart/\n-rw------- 1 root root  576 12月  4 11:04 default.xml\n\n\n\n$ ll /etc/libvirt/qemu/networks/autostart  \n總計 8\ndrwxr-xr-x 2 root root 4096 12月  4 11:04 ./\ndrwxr-xr-x 3 root root 4096 12月  4 11:04 ../\nlrwxrwxrwx 1 root root   38 12月  4 11:04 default.xml -> /etc/libvirt/qemu/networks/default.xml\n\n\n\n$ ll /etc/libvirt/storage \n總計 32\ndrwxr-xr-x 3 root root 4096 12月  4 12:51 ./\ndrwxr-xr-x 7 root root 4096 12月  4 11:04 ../\ndrwxr-xr-x 2 root root 4096 12月  4 12:51 autostart/\n-rw------- 1 root root  530 12月  4 12:51 boot.xml\n-rw------- 1 root root  560 12月  1 21:55 debian-001.xml\n-rw------- 1 root root  538 12月  1 11:30 default.xml\n-rw------- 1 root root  524 12月  1 11:39 ISO.xml\n-rw------- 1 root root  540 12月  1 11:34 Ubuntu.xml\n")])])]),n("hr"),e._v(" "),n("h2",{attrs:{id:"建置-tap-網路"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#建置-tap-網路"}},[e._v("#")]),e._v(" 建置 tap 網路")]),e._v(" "),n("p",[e._v("【參考】： https://gist.github.com/extremecoders-re/e8fd8a67a515fee0c873dcafc81d811c")]),e._v(" "),n("p",[n("strong",[e._v("（1）安裝工具軟體")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("sudo apt install uml-utilities\n")])])]),n("p",[n("strong",[e._v("（2）建立虛擬橋接器： br0")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("sudo brctl addbr br0\n")])])]),n("p",[n("strong",[e._v("（3）清除主機網路卡的 IP 網址")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("sudo ip addr flush dev enx00e04c361a3c\n")])])]),n("p",[n("strong",[e._v("（4）設定主機網路卡為虛擬橋接器的網路介面")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("sudo brctl addif br0 enx00e04c361a3c\n\nip a\n...\n3: br0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether 00:e0:4c:36:1a:3c brd ff:ff:ff:ff:ff:ff\n    inet 192.168.66.213/24 brd 192.168.66.255 scope global dynamic br0\n       valid_lft 581410sec preferred_lft 581410sec\n    inet6 fd00:30b7:d45e:4bf2:2e0:4cff:fe36:1a3c/64 scope global dynamic mngtmpaddr noprefixroute \n       valid_lft 535428sec preferred_lft 401571sec\n    inet6 fe80::5c0f:1dff:fe73:dd9c/64 scope link \n       valid_lft forever preferred_lft forever\n4: enx00e04c361a3c: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel master br0 state UP group default qlen 1000\n    link/ether 00:e0:4c:36:1a:3c brd ff:ff:ff:ff:ff:ff\n")])])]),n("p",[n("strong",[e._v("（5）建立虛擬網路介面卡：tap0 ，並設定使用者為 login 時的使用者帳號")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("sudo tunctl -t tap0 -u `whoami`\n\nip a\n...\n27: tap0: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether 1a:ba:c5:15:8c:24 brd ff:ff:ff:ff:ff:ff\n")])])]),n("p",[n("strong",[e._v("（6）將虛擬網路介面卡（tap0）連上虛擬橋接器（br0）")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("sudo brctl addif br0 tap0\n\nip a\n...\n27: tap0: <BROADCAST,MULTICAST> mtu 1500 qdisc noop master br0 state DOWN group default qlen 1000\n    link/ether 1a:ba:c5:15:8c:24 brd ff:ff:ff:ff:ff:ff\n")])])]),n("p",[n("strong",[e._v("（7）啟動 tap 網路需使用的所有裝置")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("sudo ifconfig enx00e04c361a3c up\nsudo ifconfig tap0 up\nsudo ifconfig br0 up\n")])])]),n("p",[n("strong",[e._v("（8）驗證虛擬網路介面卡（tap0）確實已接上虛擬橋器（br0）")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ brctl show\nbridge name        bridge id                STP enabled       interfaces\nbr0                8000.00e04c361a3c        no                enx00e04c361a3c\n                                                              tap0\nvibr0              8000.52540001cd21        yes               vibr0-nic\n")])])]),n("p",[n("strong",[e._v("（9）設定虛擬橋接器在網路介面使用的 IP （由 DHCP 伺服器發配）")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ sudo dhclient -v br0\nInternet Systems Consortium DHCP Client 4.4.1\nCopyright 2004-2018 Internet Systems Consortium.\nAll rights reserved.\nFor info, please visit https://www.isc.org/software/dhcp/\n\nListening on LPF/br0/00:e0:4c:36:1a:3c\nSending on   LPF/br0/00:e0:4c:36:1a:3c\nSending on   Socket/fallback\nDHCPDISCOVER on br0 to 255.255.255.255 port 67 interval 3 (xid=0xa806e24f)\nDHCPOFFER of 192.168.66.213 from 192.168.66.1\nDHCPREQUEST for 192.168.66.213 on br0 to 255.255.255.255 port 67 (xid=0x4fe206a8)\nDHCPACK of 192.168.66.213 from 192.168.66.1 (xid=0xa806e24f)\nRTNETLINK answers: File exists\ncmp: EOF on /tmp/tmp.mS1wZw0aVa which is empty\nbound to 192.168.66.213 -- renewal in 284457 seconds.\n")])])]),n("p",[n("strong",[e._v("（10）安裝 VM ，用以驗證虚擬橋接器設定的正確性")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ sudo qemu-system-i386 \\\n  -cdrom Core-current.iso \\\n  -boot d \\\n  -netdev tap,id=mynet0,ifname=tap0,script=no,downscript=no \\\n  -device e1000,netdev=mynet0,mac=52:55:00:d1:55:01\n\n\n./s01-create-hd\n./s02-install-vm\n")])])]),n("hr"),e._v(" "),n("h2",{attrs:{id:"network-管理指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#network-管理指令"}},[e._v("#")]),e._v(" Network 管理指令")]),e._v(" "),n("p",[n("strong",[e._v("使用 ip 列舉作業系統已有的網路裝置")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ ip link\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n2: eno1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel master bridge0 state UP mode DEFAULT group default qlen 1000\n    link/ether 90:2b:34:d1:a6:1b brd ff:ff:ff:ff:ff:ff\n3: wlxd0c0bf50e619: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP mode DORMANT group default qlen 1000\n    link/ether d0:c0:bf:50:e6:19 brd ff:ff:ff:ff:ff:ff\n4: enxd2c5f35747bc: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc fq_codel state DOWN mode DEFAULT group default qlen 1000\n    link/ether d2:c5:f3:57:47:bc brd ff:ff:ff:ff:ff:ff\n5: bridge0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000\n    link/ether 90:2b:34:d1:a6:1b brd ff:ff:ff:ff:ff:ff\n7: virbr0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN mode DEFAULT group default qlen 1000\n    link/ether 52:54:00:d5:1e:01 brd ff:ff:ff:ff:ff:ff\n8: virbr0-nic: <BROADCAST,MULTICAST> mtu 1500 qdisc fq_codel master virbr0 state DOWN mode DEFAULT group default qlen 1000\n    link/ether 52:54:00:d5:1e:01 brd ff:ff:ff:ff:ff:ff\n")])])]),n("p",[n("strong",[e._v("使用 ip 查詢某網路裝置的狀庇")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ ip a show dev eno1\n2: eno1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel master bridge0 state UP group default qlen 1000\n    link/ether 90:2b:34:d1:a6:1b brd ff:ff:ff:ff:ff:ff\n")])])]),n("p",[n("strong",[e._v("使用 network-manager 管理 Network Manager Service")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ sudo systemctl status network-manager\n● NetworkManager.service - Network Manager\n     Loaded: loaded (/lib/systemd/system/NetworkManager.service; enabled; vendor preset: enabled)\n     Active: active (running) since Mon 2020-12-07 12:32:45 CST; 7min ago\n       Docs: man:NetworkManager(8)\n   Main PID: 18102 (NetworkManager)\n      Tasks: 3 (limit: 19083)\n     Memory: 7.8M\n     CGroup: /system.slice/NetworkManager.service\n             └─18102 /usr/sbin/NetworkManager --no-daemon\n\n12月 07 12:32:50 SRV-2020 NetworkManager[18102]: <info>  [1607315570.1816] device (wlxd0c0bf50e619): state change: ip-config -> ip-chec>\n12月 07 12:32:50 SRV-2020 NetworkManager[18102]: <info>  [1607315570.1864] device (wlxd0c0bf50e619): state change: ip-check -> secondar>\n12月 07 12:32:50 SRV-2020 NetworkManager[18102]: <info>  [1607315570.1868] device (wlxd0c0bf50e619): state change: secondaries -> activ>\n12月 07 12:32:50 SRV-2020 NetworkManager[18102]: <info>  [1607315570.1903] device (wlxd0c0bf50e619): Activation: successful, device act>\n12月 07 12:32:51 SRV-2020 NetworkManager[18102]: <info>  [1607315571.3478] manager: startup complete\n12月 07 12:32:54 SRV-2020 NetworkManager[18102]: <info>  [1607315574.4242] dhcp6 (wlxd0c0bf50e619): activation: beginning transaction (>\n12月 07 12:33:32 SRV-2020 NetworkManager[18102]: <warn>  [1607315612.9881] dhcp6 (bridge0): request timed out\n12月 07 12:33:32 SRV-2020 NetworkManager[18102]: <info>  [1607315612.9882] dhcp6 (bridge0): state changed unknown -> timeout\n12月 07 12:33:39 SRV-2020 NetworkManager[18102]: <warn>  [1607315619.9881] dhcp6 (wlxd0c0bf50e619): request timed out\n12月 07 12:33:39 SRV-2020 NetworkManager[18102]: <info>  [1607315619.9882] dhcp6 (wlxd0c0bf50e619): state changed unknown -> timeout\n")])])]),n("p",[n("strong",[e._v("使用 nmcli 指令觀察作業系統已安裝的網路裝置（dev: device)")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ nmcli dev\nDEVICE                   TYPE      STATE     CONNECTION   \nbridge0                  bridge    已連線    橋接的連線 1 \nwlxd0c0bf50e619          wifi      已連線    CCC99-5G     \nvirbr0                   bridge    已連線    virbr0       \neno1                     ethernet  已連線    eno1         \n78:6C:1C:CB:0F:61        bt        離線      --           \np2p-dev-wlxd0c0bf50e619  wifi-p2p  離線      --           \nenxd2c5f35747bc          ethernet  無法使用  --           \nlo                       loopback  不受管理  --           \nvirbr0-nic               tun       不受管理  --    \n")])])]),n("p",[n("strong",[e._v("查詢連線狀態")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ nmcli general status\nSTATE   CONNECTIVITY  WIFI-HW  WIFI    WWAN-HW  WWAN   \n已連線  已滿          已啟用   已啟用  已啟用   已啟用 \n")])])]),n("p",[n("strong",[e._v("Device Status")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ nmcli dev status\nDEVICE                   TYPE      STATE     CONNECTION   \nbridge0                  bridge    已連線    橋接的連線 1 \nwlxd0c0bf50e619          wifi      已連線    CCC99-5G     \nvirbr0                   bridge    已連線    virbr0       \neno1                     ethernet  已連線    eno1         \n78:6C:1C:CB:0F:61        bt        離線      --           \np2p-dev-wlxd0c0bf50e619  wifi-p2p  離線      --           \nenxd2c5f35747bc          ethernet  無法使用  --           \nlo                       loopback  不受管理  --           \nvirbr0-nic               tun       不受管理  --           \n")])])]),n("p",[n("strong",[e._v("Device Status Report")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ nmcli -p d status\n==============\n  裝置的狀態\n==============\nDEVICE                   TYPE      STATE     CONNECTION   \n-------------------------------------------------------------------------\nbridge0                  bridge    已連線    橋接的連線 1 \nwlxd0c0bf50e619          wifi      已連線    CCC99-5G     \nvirbr0                   bridge    已連線    virbr0       \neno1                     ethernet  已連線    eno1         \n78:6C:1C:CB:0F:61        bt        離線      --           \np2p-dev-wlxd0c0bf50e619  wifi-p2p  離線      --           \nenxd2c5f35747bc          ethernet  無法使用  --           \nlo                       loopback  不受管理  --           \nvirbr0-nic               tun       不受管理  --           \n")])])]),n("p",[n("strong",[e._v("Connections of configured on the system")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ nmcli con show\nNAME                 UUID                                  TYPE       DEVICE          \n橋接的連線 1         c9171de1-ee5e-4667-9bd6-42c35b759ec8  bridge     bridge0         \nCCC99-5G             fddcb72d-251a-42be-bd72-6f3e16ccdbdd  wifi       wlxd0c0bf50e619 \neno1                 eb312132-e6b2-46cd-9485-cc3fd5593a07  ethernet   eno1            \nvirbr0               ab7a56f5-7685-4b67-9130-11b9a2ca95da  bridge     virbr0          \nbridge0 slave 1      1a1764cd-0dd2-4f7e-8f24-4236beeb3a5e  ethernet   --              \nCCC Dlink-6AD2-5GHz  2219a958-d49c-4b27-a936-77208aba2139  wifi       --              \nHotspot              65a39bb3-f67c-4a7b-bd95-62493218aa99  wifi       --              \niPhone-CCC 網路      8349ed64-e9c5-4fe6-ace1-e37bc41c726f  bluetooth  --              \nnetplan-eno1         10838d80-caeb-349e-ba73-08ed16d4d666  ethernet   --           \n")])])]),n("p",[n("strong",[e._v("Activated connections")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ nmcli con show -a\nNAME          UUID                                  TYPE      DEVICE          \n橋接的連線 1  c9171de1-ee5e-4667-9bd6-42c35b759ec8  bridge    bridge0         \nCCC99-5G      fddcb72d-251a-42be-bd72-6f3e16ccdbdd  wifi      wlxd0c0bf50e619 \neno1          eb312132-e6b2-46cd-9485-cc3fd5593a07  ethernet  eno1            \nvirbr0        ab7a56f5-7685-4b67-9130-11b9a2ca95da  bridge    virbr0          \n")])])]),n("p",[n("strong",[e._v("WiFi devices")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ nmcli device wifi list\nIN-USE  BSSID              SSID                 MODE   CHAN  RATE        SIGNAL  BARS  SECURITY  \n        74:DA:DA:03:6A:D4  CCC Dlink-6AD2-5GHz  Infra  153   270 Mbit/s  69      ▂▄▆_  WPA1 WPA2 \n        74:DA:DA:03:6A:D2  CCC Dlink-6AD2       Infra  3     270 Mbit/s  67      ▂▄▆_  WPA1 WPA2 \n*       30:B7:D4:5E:4B:F8  CCC99-5G             Infra  6     195 Mbit/s  51      ▂▄__  WPA2      \n        80:30:DC:2E:B3:E5  FOXC_BD_AP_SSID      Infra  11    65 Mbit/s   37      ▂▄__  WPA1 WPA2 \n")])])]),n("p",[n("strong",[e._v("Delete a device")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ nmcli d status                  \nDEVICE                   TYPE      STATE     CONNECTION   \nbridge0                  bridge    已連線    橋接的連線 1 \nwlxd0c0bf50e619          wifi      已連線    CCC99-5G     \nvirbr0                   bridge    已連線    virbr0       \neno1                     ethernet  已連線    eno1         \n78:6C:1C:CB:0F:61        bt        離線      --           \np2p-dev-wlxd0c0bf50e619  wifi-p2p  離線      --           \nenxd2c5f35747bc          ethernet  無法使用  --           \nlo                       loopback  不受管理  --           \nvirbr0-nic               tun       不受管理  --           \n\n$ sudo nmcli con delete virbr0    \n連線「virbr0」 (ab7a56f5-7685-4b67-9130-11b9a2ca95da) 已成功刪除。\n\n$ nmcli d status\nDEVICE                   TYPE      STATE     CONNECTION   \nbridge0                  bridge    已連線    橋接的連線 1 \nwlxd0c0bf50e619          wifi      已連線    CCC99-5G     \neno1                     ethernet  已連線    eno1         \nvirbr0                   bridge    離線      --           \n78:6C:1C:CB:0F:61        bt        離線      --           \np2p-dev-wlxd0c0bf50e619  wifi-p2p  離線      --           \nenxd2c5f35747bc          ethernet  無法使用  --           \nlo                       loopback  不受管理  --           \nvirbr0-nic               tun       不受管理  --         \n")])])]),n("p",[n("strong",[e._v("nmcli delete a network device")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ nmcli d       \nDEVICE                   TYPE      STATE     CONNECTION   \nbridge0                  bridge    已連線    橋接的連線 1 \nwlxd0c0bf50e619          wifi      已連線    CCC99-5G     \neno1                     ethernet  已連線    eno1         \nvirbr0                   bridge    離線      --           \n78:6C:1C:CB:0F:61        bt        離線      --           \np2p-dev-wlxd0c0bf50e619  wifi-p2p  離線      --           \nenxd2c5f35747bc          ethernet  無法使用  --           \nlo                       loopback  不受管理  --           \nvirbr0-nic               tun       不受管理  --           \n\n\n\n$ nmcli d delete virbr0\n裝置「virbr0」已成功移除。\n\n\n\n$ nmcli d              \nDEVICE                   TYPE      STATE     CONNECTION   \nbridge0                  bridge    已連線    橋接的連線 1 \nwlxd0c0bf50e619          wifi      已連線    CCC99-5G     \neno1                     ethernet  已連線    eno1         \n78:6C:1C:CB:0F:61        bt        離線      --           \np2p-dev-wlxd0c0bf50e619  wifi-p2p  離線      --           \nenxd2c5f35747bc          ethernet  無法使用  --           \nlo                       loopback  不受管理  --           \nvirbr0-nic               tun       不受管理  --           \n")])])]),n("hr"),e._v(" "),n("h2",{attrs:{id:"硬碟管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#硬碟管理"}},[e._v("#")]),e._v(" 硬碟管理")]),e._v(" "),n("p",[n("strong",[e._v("增加硬碟空間")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("$ qemu-img info archlinux.qcow2 \nimage: archlinux.qcow2\nfile format: qcow2\nvirtual size: 20 GiB (21474836480 bytes)\ndisk size: 3.32 MiB\ncluster_size: 65536\nFormat specific information:\n    compat: 1.1\n    lazy refcounts: true\n    refcount bits: 16\n    corrupt: false\n\n$ qemu-img resize archlinux.qcow2 +40G\nImage resized.\n\n$ qemu-img info archlinux.qcow2 \nimage: archlinux.qcow2\nfile format: qcow2\nvirtual size: 60 GiB (64424509440 bytes)\ndisk size: 3.32 MiB\ncluster_size: 65536\nFormat specific information:\n    compat: 1.1\n    lazy refcounts: true\n    refcount bits: 16\n    corrupt: false\n")])])]),n("hr"),e._v(" "),n("h2",{attrs:{id:"參考文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#參考文件"}},[e._v("#")]),e._v(" 參考文件")]),e._v(" "),n("p",[n("strong",[e._v("virt-install 指令指引")]),e._v("\nhttps://linux.die.net/man/1/virt-install")]),e._v(" "),n("p",[n("strong",[e._v("qemu-system-x86_64 的 options 參考文件")]),e._v("\nhttps://www.qemu.org/docs/master/system/index.html")]),e._v(" "),n("p",[n("strong",[e._v("libvirt Virtual Networking")]),e._v("\nhttps://wiki.libvirt.org/page/VirtualNetworking")]),e._v(" "),n("p",[n("strong",[e._v("Ubuntu 20.04 Network Management")]),e._v("\nhttps://www.answertopia.com/ubuntu/ubuntu-network-management/")]),e._v(" "),n("p",[n("strong",[e._v("Ubuntu 20.04 network Configuration")]),e._v("\nhttps://linuxhint.com/ubuntu_20-04_network_configuration/")]),e._v(" "),n("p",[n("strong",[e._v("啟用 UEFI  支援")])]),e._v(" "),n("p",[e._v("https://ostechnix.com/enable-uefi-support-for-kvm-virtual-machines-in-linux/")]),e._v(" "),n("p",[e._v("https://www.systutorials.com/docs/linux/man/1-qemu-system-x86_64/")]),e._v(" "),n("p",[n("strong",[e._v("How to install KVM on Ubuntu 20.04")])]),e._v(" "),n("p",[e._v("https://websiteforstudents.com/how-to-install-kvm-on-ubuntu-20-04-18-04/")]),e._v(" "),n("p",[n("strong",[e._v("How to install KVM on Ubuntu 20.04 LTS Headless Server")])]),e._v(" "),n("p",[e._v("https://www.cyberciti.biz/faq/how-to-install-kvm-on-ubuntu-20-04-lts-headless-server/")]),e._v(" "),n("p",[n("strong",[e._v("Qemu/Virt-manager/KVM Bridge and NAT Networking")])]),e._v(" "),n("p",[e._v("https://www.youtube.com/watch?v=amTJHm19ts0&&t=135s")]),e._v(" "),n("p",[n("a",{attrs:{href:"https://youtu.be/amTJHm19ts0?t=135s",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://youtu.be/amTJHm19ts0?t=135s"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("strong",[e._v("建置 QEMU/Libvirt 環境適用的 VM Network")])]),e._v(" "),n("p",[e._v("https://octetz.com/docs/2020/2020-11-13-vm-networks/")]),e._v(" "),n("p",[n("strong",[e._v("Setting up Qemu with a Tap Interface")])]),e._v(" "),n("p",[e._v("https://gist.github.com/extremecoders-re/e8fd8a67a515fee0c873dcafc81d811c")]),e._v(" "),n("p",[n("a",{attrs:{href:"https://gist.github.com/extremecoders-re/e8fd8a67a515fee0c873dcafc81d811c",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://gist.github.com/extremecoders-re/e8fd8a67a515fee0c873dcafc81d811c"),n("OutboundLink")],1)])])}),[],!1,null,null,null);n.default=o.exports}}]);