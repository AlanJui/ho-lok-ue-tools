(window.webpackJsonp=window.webpackJsonp||[]).push([[123],{411:function(r,e,s){"use strict";s.r(e);var n=s(10),t=Object(n.a)({},(function(){var r=this,e=r._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":r.$parent.slotKey}},[e("h1",{attrs:{id:"在ubuntu-16-04安裝xrdp-0-9-1"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在ubuntu-16-04安裝xrdp-0-9-1"}},[r._v("#")]),r._v(" 在Ubuntu 16.04安裝xRDP 0.9.1")]),r._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[r._v("sudo add-apt-repository ppa:hermlnx/xrdp\nsudo apt-get update\nsudo apt-get install xrdp\n")])])]),e("p",[r._v("/etc/X11/Xwrapper.config")]),r._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[r._v("allowed_users=anybody\n\n\nsudo apt-get install xserver-xorg-legacy\n\n\nsudo dpkg-reconfigure xserver-xorg-legacy\n# 可以啟動 X Server 的使用者： 選〔無限制〕\n")])])]),e("p",[e("strong",[r._v("重新啟動 xrdp service")])]),r._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[r._v("sudo systemctl restart xrdp\nsudo systemctl status xrdp\n")])])]),e("p",[r._v("或⋯⋯")]),r._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[r._v("sudo service xrdp restart\nsudo service xrdp status\n\n\n$ sudo service xrdp status\n● xrdp.service - xrdp daemon\n   Loaded: loaded (/lib/systemd/system/xrdp.service; enabled; vendor preset: enabled)\n   Active: active (running) since Fri 2019-03-29 13:53:56 CST; 2h 28min ago\n     Docs: man:xrdp(8)\n           man:xrdp.ini(5)\n  Process: 1983 ExecStart=/usr/local/sbin/xrdp $XRDP_OPTIONS (code=exited, status=0/SUCCESS)\n Main PID: 2036 (xrdp)\n    Tasks: 1 (limit: 4915)\n   CGroup: /system.slice/xrdp.service\n           └─2036 /usr/local/sbin/xrdp\n\n 3月 29 16:12:41 SRV-01 xrdp[4631]: (4631)(139720457262912)[DEBUG] Closed socket 18 (AF_INET 127.0.0.1:35650)\n 3月 29 16:12:41 SRV-01 xrdp[4631]: (4631)(139720457262912)[INFO ] The following channel is allowed: rdpdr (0)\n 3月 29 16:12:42 SRV-01 xrdp[4631]: (4631)(139720457262912)[INFO ] The following channel is allowed: rdpsnd (1)\n 3月 29 16:12:42 SRV-01 xrdp[4631]: (4631)(139720457262912)[INFO ] The following channel is allowed: cliprdr (2)\n 3月 29 16:12:42 SRV-01 xrdp[4631]: (4631)(139720457262912)[INFO ] The following channel is allowed: drdynvc (3)\n 3月 29 16:12:42 SRV-01 xrdp[4631]: (4631)(139720457262912)[DEBUG] The allow channel list now initialized for this session\n 3月 29 16:16:07 SRV-01 xrdp[4631]: (4631)(139720457262912)[DEBUG] Closed socket 12 (AF_INET 192.168.66.10:3389)\n 3月 29 16:16:08 SRV-01 xrdp[4631]: (4631)(139720457262912)[DEBUG] xrdp_mm_module_cleanup\n 3月 29 16:16:08 SRV-01 xrdp[4631]: (4631)(139720457262912)[DEBUG] Closed socket 19 (AF_UNIX)\n 3月 29 16:16:08 SRV-01 xrdp[4631]: (4631)(139720457262912)[DEBUG] Closed socket 20 (AF_UNIX)\n")])])]),e("p",[r._v("參考資訊：")]),r._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[r._v('$ sudo add-apt-repository ppa:hermlnx/xrdp\n This PPA offers a backport of the Bionic xrdp package to Xenial LTS\n\nxrdp offers a graphical login to a remote client using RDP (the Remote Desktop Protocol). xrdp can connect to a locally created X.org session with the xorgxrdp drivers, to a VNC X11 server, and forward to another RDP server.\n\nIn the xorgxrdp (which replaces X11RDP) and VNC modes, it provides a fully functional Linux terminal server, offering an X-Window desktop to the user. In the RDP or VNC forwarding mode, any sort of desktop can be used.\n\nIf the Xorg server does not start through a RDP session after installation of this PPA packages, you may need to install the xserver-xorg-legacy package and/or set "allowed_users=anybody" in /etc/X11/Xwrapper.config to allow users, once they are logged in through xrdp, to start their own X server.\n 更多資訊：https://launchpad.net/~hermlnx/+archive/ubuntu/xrdp\n請輸入 [ENTER] 繼續，或 Ctrl-C 來取消加入動作\n')])])]),e("p",[r._v("【參考文件】：\nInstalling xrdp 0.9.1 on Ubuntu 16.04 Xenial： https://netdevops.me/2017/installing-xrdp-0.9.1-on-ubuntu-16.04-xenial/")]),r._v(" "),e("hr"),r._v(" "),e("h1",{attrs:{id:"異常問題排解"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#異常問題排解"}},[r._v("#")]),r._v(" 異常問題排解")]),r._v(" "),e("h2",{attrs:{id:"無法啟動-xrdp-service-pid-file-權限不足"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#無法啟動-xrdp-service-pid-file-權限不足"}},[r._v("#")]),r._v(" 無法啟動 xrdp service — PID file 權限不足")]),r._v(" "),e("p",[r._v("啟動 xrdp service  ，卻發生如下之錯誤….")]),r._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[r._v("...\nxrdp.service: PID file /var/run/xrdp/xrdp.pid not readable (yet?) after start: No such file or directory\n...\n")])])]),e("p",[r._v("【詳細資訊】：")]),r._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[r._v("$ sudo systemctl status xrdp\n● xrdp.service - xrdp daemon\n   Loaded: loaded (/lib/systemd/system/xrdp.service; enabled; vendor preset: enabled)\n   Active: active (running) since Sun 2018-05-13 12:04:35 CST; 13s ago\n     Docs: man:xrdp(8)\n           man:xrdp.ini(5)\n  Process: 26007 ExecStop=/usr/sbin/xrdp $XRDP_OPTIONS --kill (code=exited, status=0/SUCCESS)\n  Process: 26074 ExecStart=/usr/sbin/xrdp $XRDP_OPTIONS (code=exited, status=0/SUCCESS)\n  Process: 26056 ExecStartPre=/bin/sh /usr/share/xrdp/socksetup (code=exited, status=0/SUCCESS)\n Main PID: 26077 (xrdp)\n    Tasks: 1\n   Memory: 1.7M\n      CPU: 13ms\n   CGroup: /system.slice/xrdp.service\n           └─26077 /usr/sbin/xrdp\n\nMay 13 12:04:34 srv-01 systemd[1]: Starting xrdp daemon...\nMay 13 12:04:34 srv-01 xrdp[26074]: (26074)(139744632137472)[DEBUG] Testing if xrdp can listen on 0.0.0.0 port 3389.\nMay 13 12:04:34 srv-01 xrdp[26074]: (26074)(139744632137472)[DEBUG] Closed socket 7 (AF_INET6 :: port 3389)\nMay 13 12:04:34 srv-01 systemd[1]: xrdp.service: PID file /var/run/xrdp/xrdp.pid not readable (yet?) after start: No such file or directory\nMay 13 12:04:35 srv-01 systemd[1]: Started xrdp daemon.\nMay 13 12:04:36 srv-01 xrdp[26077]: (26077)(139744632137472)[INFO ] starting xrdp with pid 26077\nMay 13 12:04:36 srv-01 xrdp[26077]: (26077)(139744632137472)[INFO ] listening to port 3389 on 0.0.0.0\n$ \n")])])]),e("p",[r._v("檢查 xrdp.pip 檔案之權限，為 User: xrdp / Group: xrdp 所使用：")]),r._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[r._v("$ ll /var/run/xrdp/\n總計 8\ndrwxr-xr-x  3 xrdp xrdp  100 May 13 13:02 ./\ndrwxr-xr-x 33 root root 1060 May 13 13:02 ../\ndrwxrwsrwt  2 root xrdp   40 May 13 13:02 sockdir/\n-rw-------  1 xrdp xrdp    4 May 13 13:02 xrdp.pid\n-rw-------  1 root root    4 May 13 13:02 xrdp-sesman.pid\n\n$ sudo chown -R root:root /var/run/xrdp\n")])])]),e("p",[r._v("或⋯⋯")]),r._v(" "),e("p",[e("strong",[r._v("變更檔案 xrdp.pid 的擁有者為 root")])]),r._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[r._v("$ ls -al /run/xrdp.pid\n$ sudo chown -R root:root /run/xrdp.pid\n$ ls -al /run/xrdp.pid\n-rw------- 1 root root 4  3月 29 13:53 /run/xrdp.pid\n")])])]),e("p",[e("strong",[r._v("確認 xrdp.service 中使用者與群組之設定")])]),r._v(" "),e("p",[r._v("檢查 xrdp.service 檔案的設定，User與Group的設定皆指定為 root：")]),r._v(" "),e("p",[r._v("/lib/systemd/system/xrdp.service")]),r._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[r._v("[Unit]\nDescription=xrdp daemon\nDocumentation=man:xrdp(8) man:xrdp.ini(5)\nRequires=xrdp-sesman.service\nAfter=network.target xrdp-sesman.service\n\n[Service]\nType=forking\nPIDFile=/var/run/xrdp.pid\nEnvironmentFile=-/etc/sysconfig/xrdp\nEnvironmentFile=-/etc/default/xrdp\n#User=root\n#Group=root\n#PermissionsStartOnly=true\nExecStartPre=/bin/sh /usr/share/xrdp/socksetup\nExecStart=/usr/sbin/xrdp $XRDP_OPTIONS\nExecStop=/usr/sbin/xrdp $XRDP_OPTIONS --kill\n\n[Install]\nWantedBy=multi-user.target\n")])])]),e("p",[r._v("檢視 xrdp-sesman.service 設定檔，確認沒有與 User / Group 相關的設定：")]),r._v(" "),e("p",[r._v("/lib/systemd/system/xrdp-sesman.service")]),r._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[r._v("[Unit]\nDescription=xrdp session manager\nDocumentation=man:xrdp-sesman(8) man:sesman.ini(5)\nAfter=network.target\nStopWhenUnneeded=true\nBindsTo=xrdp.service\n\n[Service]\nType=forking\nPIDFile=/var/run/xrdp/xrdp-sesman.pid\nRuntimeDirectory=xrdp\nEnvironmentFile=-/etc/sysconfig/xrdp\nEnvironmentFile=-/etc/default/xrdp\nExecStart=/usr/sbin/xrdp-sesman $SESMAN_OPTIONS\nExecStop=/usr/sbin/xrdp-sesman $SESMAN_OPTIONS --kill\n\n[Install]\nWantedBy=multi-user.target\n")])])]),e("p",[r._v("變更設定如下：")]),r._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[r._v("...\nUser=root\nGroup=root\n...\n")])])]),e("p",[r._v("確認作業系統已建立「群組： xrdp」、「使用者：xrdp」：")]),r._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[r._v("#cat /etc/groups | grep xrdp\n$ groups xrdp\nxrdp : xrdp\n\n#cat /etc/passwd | grep xrdp\n$ id xrdp\nuid=123(xrdp) gid=130(xrdp) 群組=130(xrdp)\n")])])]),e("p",[r._v("將 user: root 加入 group: xrdp")]),r._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[r._v("$ sudo usermod -a -G xrdp root\n\n$ id root\nuid=0(root) gid=0(root) 群組=0(root),130(xrdp)\n\n\n\n$ ll /var/run/xrdp/xrdp.pid\n-rw------- 1 xrdp xrdp 4 May 13 13:57 /var/run/xrdp/xrdp.pid\n\n$ sudo chmod 660 /var/run/xrdp/xrdp.pid\n\n$ ll /var/run/xrdp/xrdp.pid\n-rw-rw---- 1 xrdp xrdp 4 May 13 13:57 /var/run/xrdp/xrdp.pid\n")])])]),e("p",[r._v("重新啟動 xrdp.service")]),r._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[r._v("sudo systemctl daemon-reload\nsudo systemctl enable xrdp.service\nsudo systemctl restart xrdp\nsudo systemctl status xrdp\n")])])]),e("p",[r._v("【安裝時參考資訊】：")]),r._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[r._v("$ sudo systemctl enable xrdp.service\nSynchronizing state of xrdp.service with SysV init with /lib/systemd/systemd-sysv-install...\nExecuting /lib/systemd/systemd-sysv-install enable xrdp\ninsserv: warning: script 'S02mLNHIICC' missing LSB tags and overrides\ninsserv: warning: script 'mLNHIICC' missing LSB tags and overrides\ninsserv: warning: script 'S02mLNHIICC' missing LSB tags and overrides\ninsserv: warning: script 'mLNHIICC' missing LSB tags and overrides\n")])])]),e("hr"),r._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[r._v("dpkg -l xrdp x11rdp\n")])])]),e("hr"),r._v(" "),e("h1",{attrs:{id:"在-debian-9-安裝-xrdp"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在-debian-9-安裝-xrdp"}},[r._v("#")]),r._v(" 在 Debian 9 安裝 xRDP")]),r._v(" "),e("p",[e("strong",[r._v("（1）安裝軟體套件及設定")])]),r._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[r._v("sudo apt install xrdp guacamole\n")])])]),e("p",[r._v("【註】：")]),r._v(" "),e("ol",[e("li",[r._v("不用安裝 xserver-xorg-legacy 套件")]),r._v(" "),e("li",[r._v("/etc/X11/Xwrapper.config 設定檔的內容，使用預設不要改：\nallowed_users=console")])]),r._v(" "),e("p",[e("strong",[r._v("（2）啟動 Service")])]),r._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[r._v("sudo reboot\n")])])]),e("p",[r._v("不用執行：")]),r._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",[e("code",[r._v("sudo systemctl daemon-reload\nsudo systemctl enable xrdp\nsudo systemctl restart xrdp\n")])])]),e("p",[e("strong",[r._v("（3）XRDP Client 連線")]),r._v("\n連線時的「使用者帳號」，使用有「login」權限者尸。")]),r._v(" "),e("ul",[e("li",[r._v("protocol: xvnc")]),r._v(" "),e("li",[r._v("user:")]),r._v(" "),e("li",[r._v("password:")])])])}),[],!1,null,null,null);e.default=t.exports}}]);