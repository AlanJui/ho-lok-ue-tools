(window.webpackJsonp=window.webpackJsonp||[]).push([[187],{474:function(e,t,o){"use strict";o.r(t);var r=o(10),n=Object(r.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"asp-net-core-筆記"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#asp-net-core-筆記"}},[e._v("#")]),e._v(" ASP.NET Core 筆記")]),e._v(" "),t("p",[e._v("筆記 ASP.NET Core 如何使用 dotnet CLI工具，令 Code Generation Tools 可自動「產出」，Controller 、 View 類別程式碼。")]),e._v(" "),t("p",[e._v("【重要參考】： dotnet 指令之使用")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://docs.microsoft.com/en-us/ef/core/miscellaneous/cli/dotnet",target:"_blank",rel:"noopener noreferrer"}},[e._v(".NET Command Line Tools for EF Core"),t("OutboundLink")],1)]),e._v(" "),t("li",[e._v("http://www.cnblogs.com/linezero/p/5688772.html")])]),e._v(" "),t("hr"),e._v(" "),t("h1",{attrs:{id:"create專案後"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#create專案後"}},[e._v("#")]),e._v(" Create專案後")]),e._v(" "),t("h2",{attrs:{id:"create-資料夾"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#create-資料夾"}},[e._v("#")]),e._v(" Create  資料夾")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("$ mkdir Models\n$ mkdir SQL_Scripts\n")])])]),t("h2",{attrs:{id:"在-project-csproj-安裝-cli-tools-、ef-core-及-sql-server"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在-project-csproj-安裝-cli-tools-、ef-core-及-sql-server"}},[e._v("#")]),e._v(" 在 [Project].csproj 安裝  CLI Tools 、EF Core 及 SQL Server :")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v('<Project Sdk="Microsoft.NET.Sdk.Web">\n  <PropertyGroup>\n    <TargetFramework>netcoreapp1.1</TargetFramework>\n    <PackageTargetFallback>$(PackageTargetFallback);dotnet5.6;portable-net45+win8</PackageTargetFallback>\n  </PropertyGroup>\n  <ItemGroup>\n    <DotNetCliToolReference Include="Microsoft.DotNet.Watcher.Tools" Version="1.0.0"/>\n    <DotNetCliToolReference Include="Microsoft.EntityFrameworkCore.Tools.DotNet" Version="1.0.0" />\n    <DotNetCliToolReference Include="Microsoft.VisualStudio.Web.CodeGeneration.Tools" Version="1.0.0" />\n  </ItemGroup>\n</Project>  \n\n\n$ dotnet add package Microsoft.EntityFrameworkCore.SqlServer\n$ dotnet add package Microsoft.EntityFrameworkCore.SqlServer.Design\n$ dotnet add package Microsoft.EntityFrameworkCore.Design\n$ dotnet add package Microsoft.VisualStudio.Web.CodeGeneration.Design\n\n$ dotnet restore \n')])])]),t("h2",{attrs:{id:"appsettings-json"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#appsettings-json"}},[e._v("#")]),e._v(" appsettings.json")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v('"Logging": {\n    "IncludeScopes": false,\n    "LogLevel": {\n      "Default": "Warning"\n    }\n  },\n  "ConnectionStrings": {\n    "Default": "server=localhost; database=MyBloggingDB; user id=sa; password=Passw0rd"\n  }\n}  \n')])])]),t("h2",{attrs:{id:"applicationdbcontext-cs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#applicationdbcontext-cs"}},[e._v("#")]),e._v(" ApplicationDbContext.cs")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("using System;\nusing Microsoft.EntityFrameworkCore;\nnamespace Blogging.Models\n{\n  public class ApplicationDbContext : DbContext\n  {\n    //public DbSet<Blog> Blogs { get; set; }\n    \n    public ApplicationDbContext(DbContextOptions options) : base(options)\n    {\n    }\n  }\n}\n")])])]),t("h2",{attrs:{id:"startup-cs"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#startup-cs"}},[e._v("#")]),e._v(" startup.cs")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v('using Microsoft.EntityFrameworkCore;\nusing [Project].Models;\n\npublic void ConfigureServices(IServiceCollection services)\n{\n    // Add framework services.\n    services.AddMvc();\n    services.AddDbContext<ApplicationDbContext>(options => \n        options.UseSqlServer(Configuration.GetConnectionString("Default")));\n}\n')])])]),t("h1",{attrs:{id:"自db建-model"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自db建-model"}},[e._v("#")]),e._v(" 自DB建 Model")]),e._v(" "),t("h2",{attrs:{id:"使用t-sql建db"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用t-sql建db"}},[e._v("#")]),e._v(" 使用T-SQL建DB")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("CREATE DATABASE [MyBloggingDB];\nGO\nUSE [MyBloggingDB];\nGO\nCREATE TABLE [Blog] (\n    [BlogId] int NOT NULL IDENTITY,\n    [Url] nvarchar(max) NOT NULL,\n    CONSTRAINT [PK_Blog] PRIMARY KEY ([BlogId])\n);\nGO\nCREATE TABLE [Post] (\n    [PostId] int NOT NULL IDENTITY,\n    [BlogId] int NOT NULL,\n    [Content] nvarchar(max),\n    [Title] nvarchar(max),\n    CONSTRAINT [PK_Post] PRIMARY KEY ([PostId]),\n    CONSTRAINT [FK_Post_Blog_BlogId] FOREIGN KEY ([BlogId]) REFERENCES [Blog] ([BlogId]) ON DELETE CASCADE\n);\nGO\nINSERT INTO [Blog] (Url) VALUES\n('http://blogs.msdn.com/dotnet'),\n('http://blogs.msdn.com/webdev'),\n('http://blogs.msdn.com/visualstudio')\nGO\n")])])]),t("h2",{attrs:{id:"透過-ef-core-自動產生-model-類別"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#透過-ef-core-自動產生-model-類別"}},[e._v("#")]),e._v(" 透過 EF Core 自動產生 Model 類別")]),e._v(" "),t("p",[e._v("使用 dotnet ef dbcontext scaffold 產生 Model 用類別")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v('dotnet ef dbcontext scaffold "Server=.\\;Database=Northwind;Trusted_Connection=True;" Microsoft.EntityFrameworkCore.SqlServer --schema employees --output-dir Models --context "NorthwindContext"\n\n\ndotnet ef dbcontext scaffold "Server=.\\;Database=Northwind;Trusted_Connection=True;" Microsoft.EntityFrameworkCore.SqlServer --table employees --output-dir Models\n\n\ndotnet ef dbcontext scaffold "Server=localhost; Database=Northwind; user id=sa; password=Passw0rd" Microsoft.EntityFrameworkCore.SqlServer --schema employees --output-dir Models\n\n\n$ dotnet ef dbcontext scaffold "Server=localhost; Database=MyBloggingDB; user id=sa; password=Passw0rd" Microsoft.EntityFrameworkCore.SqlServer --output-dir Models\n\n\nlanJui at MacBook-Pro-2.local in [~/workspace/dotNET/Blogging]\n16:01:24 $ dotnet ef dbcontext scaffold "Server=localhost; Database=MyBloggingDB; user id=sa; password=Passw0rd" Microsoft.EntityFrameworkCore.SqlServer --output-dir Models\n\nBuild succeeded.\n    0 Warning(s)\n    0 Error(s)\n\nTime Elapsed 00:00:03.03\n')])])]),t("h2",{attrs:{id:"建立-api-controller"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#建立-api-controller"}},[e._v("#")]),e._v(" 建立 API Controller")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("$ dotnet aspnet-codegenerator controller -name BlogsController -m Blog -dc ApplicationDbContext -api -outDir Controllers\n")])])]),t("h2",{attrs:{id:"透過-ef-core-自動產生-controller-類別及crud之action"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#透過-ef-core-自動產生-controller-類別及crud之action"}},[e._v("#")]),e._v(" 透過 EF Core 自動產生 Controller 類別及CRUD之Action")]),e._v(" "),t("h2",{attrs:{id:"scaffold-the-blogcontroller"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#scaffold-the-blogcontroller"}},[e._v("#")]),e._v(" Scaffold the BlogController")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("$ dotnet aspnet-codegenerator controller -name BlogsController -m Blog -dc ApplicationDbContext --relativeFolderPath Controllers --useDefaultLayout --referenceScriptLibraries\n\n\n\nAlanJui at MacBook-Pro-2.local in [~/workspace/dotNET/Blogging]\n17:13:08 $ dotnet aspnet-codegenerator controller -name BlogsController -m Blog -dc ApplicationDbContext --relativeFolderPath Controllers --useDefaultLayout --referenceScri\nptLibraries\nCommand Line: controller -name BlogsController -m Blog -dc ApplicationDbContext --relativeFolderPath Controllers --useDefaultLayout --referenceScriptLibraries\nMicrosoft (R) Build Engine version 15.1.1012.6693\nCopyright (C) Microsoft Corporation. All rights reserved.\n\nBuilding project ...\nMicrosoft (R) Build Engine version 15.1.1012.6693\nCopyright (C) Microsoft Corporation. All rights reserved.\n\n  Blogging -> /Users/AlanJui/workspace/dotNET/Blogging/bin/Debug/netcoreapp1.1/Blogging.dll\n\nBuild succeeded.\n    0 Warning(s)\n    0 Error(s)\n\nTime Elapsed 00:00:05.60\nCommand Line: --no-dispatch --port-number 54855 controller -name BlogsController -m Blog -dc ApplicationDbContext --relativeFolderPath Controllers --useDefaultLayout --refe\nrenceScriptLibraries --dispatcher-version 1.0.0-rtm-10308\nFinding the generator 'controller'...\nRunning the generator 'controller'...\nAttempting to compile the application in memory\nAttempting to figure out the EntityFramework metadata for the model and DbContext: Blog\nAdded Controller : /Controllers/BlogsController.cs\nAdded View : /Views/Blogs/Create.cshtml\nAdded View : /Views/Blogs/Edit.cshtml\nAdded View : /Views/Blogs/Details.cshtml\nAdded View : /Views/Blogs/Delete.cshtml\nAdded View : /Views/Blogs/Index.cshtml\nAdded additional file :Views/Shared/_ValidationScriptsPartial.cshtml\nRunTime 00:00:14.31\n")])])]),t("h2",{attrs:{id:"add-student-controller"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#add-student-controller"}},[e._v("#")]),e._v(" Add Student Controller")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("$ dotnet aspnet-codegenerator controller -name StudentsController -m Student -dc ApplicationDbContext --relativeFolderPath Controllers --useDefaultLayout --referenceScriptLibraries\n\n\n\nAlanJui at MacBook-Pro-2.local in [~/workspace/dotNET/ContosoUniversity]  on git:master ✗  bdb3326 \"完成 HomeController 的 Index Action\"\n21:03:37 $ dotnet aspnet-codegenerator controller -name StudentsController -m Student -dc ApplicationDbContext --relativeFolderPath Controllers --useDefaultLayout --referenceScriptLibraries\nCommand Line: controller -name StudentsController -m Student -dc ApplicationDbContext --relativeFolderPath Controllers --useDefaultLayout --referenceScriptLibraries\nMicrosoft (R) Build Engine version 15.1.1012.6693\nCopyright (C) Microsoft Corporation. All rights reserved.\n\nBuilding project ...\nMicrosoft (R) Build Engine version 15.1.1012.6693\nCopyright (C) Microsoft Corporation. All rights reserved.\n\n  ContosoUniversity -> /Users/AlanJui/workspace/dotNET/ContosoUniversity/bin/Debug/netcoreapp1.1/ContosoUniversity.dll\n\nBuild succeeded.\n    0 Warning(s)\n    0 Error(s)\n\nTime Elapsed 00:00:04.09\nCommand Line: --no-dispatch --port-number 60101 controller -name StudentsController -m Student -dc ApplicationDbContext --relativeFolderPath Controllers --useDefaultLayout --referenceScriptLibraries --dispatcher-version 1.0.0-rtm-10308\nFinding the generator 'controller'...\nRunning the generator 'controller'...\nAttempting to compile the application in memory\nAttempting to figure out the EntityFramework metadata for the model and DbContext: Student\nAdded Controller : /Controllers/StudentsController.cs\nAdded View : /Views/Students/Create.cshtml\nAdded View : /Views/Students/Edit.cshtml\nAdded View : /Views/Students/Details.cshtml\nAdded View : /Views/Students/Delete.cshtml\nAdded View : /Views/Students/Index.cshtml\nAdded additional file :Views/Shared/_ValidationScriptsPartial.cshtml\nRunTime 00:00:13.18\n")])])]),t("h2",{attrs:{id:"add-courses-controller"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#add-courses-controller"}},[e._v("#")]),e._v(" Add Courses Controller")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("$ dotnet aspnet-codegenerator controller -name CoursesController -m Course -dc ApplicationDbContext --relativeFolderPath Controllers --useDefaultLayout --referenceScriptLibraries\n\n\nAlanJui at MacBook-Pro-2.local in [~/workspace/dotNET/ContosoUniversity]  on git:master ✗  bdb3326 \"完成 HomeController 的 Index Action\"\n21:40:44 $ dotnet aspnet-codegenerator controller -name CoursesController -m Course -dc ApplicationDbContext --relativeFolderPath Controllers --useDefaultLayout --referenceScriptLibraries\nCommand Line: controller -name CoursesController -m Course -dc ApplicationDbContext --relativeFolderPath Controllers --useDefaultLayout --referenceScriptLibraries\nMicrosoft (R) Build Engine version 15.1.1012.6693\nCopyright (C) Microsoft Corporation. All rights reserved.\n\nBuilding project ...\nMicrosoft (R) Build Engine version 15.1.1012.6693\nCopyright (C) Microsoft Corporation. All rights reserved.\n\n  ContosoUniversity -> /Users/AlanJui/workspace/dotNET/ContosoUniversity/bin/Debug/netcoreapp1.1/ContosoUniversity.dll\n\nBuild succeeded.\n    0 Warning(s)\n    0 Error(s)\n\nTime Elapsed 00:00:04.14\nCommand Line: --no-dispatch --port-number 60283 controller -name CoursesController -m Course -dc ApplicationDbContext --relativeFolderPath Controllers --useDefaultLayout --referenceScriptLibraries --dispatcher-version 1.0.0-rtm-10308\nFinding the generator 'controller'...\nRunning the generator 'controller'...\nAttempting to compile the application in memory\nAttempting to figure out the EntityFramework metadata for the model and DbContext: Course\nAdded Controller : /Controllers/CoursesController.cs\nAdded View : /Views/Courses/Create.cshtml\nAdded View : /Views/Courses/Edit.cshtml\nAdded View : /Views/Courses/Details.cshtml\nAdded View : /Views/Courses/Delete.cshtml\nAdded View : /Views/Courses/Index.cshtml\nRunTime 00:00:13.59\n")])])]),t("h2",{attrs:{id:"add-enrollment-controller"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#add-enrollment-controller"}},[e._v("#")]),e._v(" Add Enrollment Controller")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[e._v("$ dotnet aspnet-codegenerator controller -name EnrollmentsController -m Enrollment -dc ApplicationDbContext --relativeFolderPath Controllers --useDefaultLayout --referenceScriptLibraries\n\n\nAlanJui at MacBook-Pro-2.local in [~/workspace/dotNET/ContosoUniversity]  on git:master ✗  bdb3326 \"完成 HomeController 的 Index Action\"\n21:52:53 $ dotnet aspnet-codegenerator controller -name EnrollmentsController -m Enrollment -dc ApplicationDbContext --relativeFolderPath Controllers --useDefaultLayout --referenceScriptLibraries\nCommand Line: controller -name EnrollmentsController -m Enrollment -dc ApplicationDbContext --relativeFolderPath Controllers --useDefaultLayout --referenceScriptLibraries\nMicrosoft (R) Build Engine version 15.1.1012.6693\nCopyright (C) Microsoft Corporation. All rights reserved.\n\nBuilding project ...\nMicrosoft (R) Build Engine version 15.1.1012.6693\nCopyright (C) Microsoft Corporation. All rights reserved.\n\n  ContosoUniversity -> /Users/AlanJui/workspace/dotNET/ContosoUniversity/bin/Debug/netcoreapp1.1/ContosoUniversity.dll\n\nBuild succeeded.\n    0 Warning(s)\n    0 Error(s)\n\nTime Elapsed 00:00:04.16\nCommand Line: --no-dispatch --port-number 60360 controller -name EnrollmentsController -m Enrollment -dc ApplicationDbContext --relativeFolderPath Controllers --useDefaultLayout --referenceScriptLibraries --dispatcher-version 1.0.0-rtm-10308\nFinding the generator 'controller'...\nRunning the generator 'controller'...\nAttempting to compile the application in memory\nAttempting to figure out the EntityFramework metadata for the model and DbContext: Enrollment\nAdded Controller : /Controllers/EnrollmentsController.cs\nAdded View : /Views/Enrollments/Create.cshtml\nAdded View : /Views/Enrollments/Edit.cshtml\nAdded View : /Views/Enrollments/Details.cshtml\nAdded View : /Views/Enrollments/Delete.cshtml\nAdded View : /Views/Enrollments/Index.cshtml\nRunTime 00:00:13.41\n")])])]),t("p",[e._v("···")])])}),[],!1,null,null,null);t.default=n.exports}}]);